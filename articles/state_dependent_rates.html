<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="macpan2">
<title>State-Dependent Rates • macpan2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="State-Dependent Rates">
<meta property="og:description" content="macpan2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/composing_simulation_models.html">Composing Related Simulation Models</a>
    <a class="dropdown-item" href="../articles/cpp_side.html">The C++ Side of McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/elementwise_binary_operators.html">Elementwise Binary Operators in the McMasterPandemic Engine</a>
    <a class="dropdown-item" href="../articles/functions.html">Mathematical Functions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/model_definitions.html">Model Definitions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/state_dependent_rates.html">State-Dependent Rates</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>State-Dependent Rates</h1>
            
      
      
      <div class="d-none name"><code>state_dependent_rates.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="decomposition-of-state-dependent-rates">Decomposition of State-Dependent Rates<a class="anchor" aria-label="anchor" href="#decomposition-of-state-dependent-rates"></a>
</h2>
<p>The vast majority of compartmental models contain flows that depend
on the states of compartments that are not directly involved in the
flows. In particular, the magnitude of the flow from compartment A to
compartment B could depend on another compartment, C. The most important
example of these dependencies is infection, and so we use the
terminology from infection processes. However, our model will subsume a
very large number of flows as special cases.</p>
<p>Let <span class="math inline">\(s\)</span> and <span class="math inline">\(x\)</span> be subsets of the state vector. The
length-<span class="math inline">\(n\)</span> vector <span class="math inline">\(s\)</span> contains the from-compartments –
typically the compartments that are susceptible to infection – for a set
of flows. The length-<span class="math inline">\(m\)</span> vector <span class="math inline">\(x\)</span> contains compartments – typically the
infectious compartments – that affect these flows. The components of
<span class="math inline">\(x\)</span> do not need to affect all
components of <span class="math inline">\(y\)</span> but they do need to
affect some of them. Note that we do not keep track of the
to-compartments in these flows because they do not matter (I think).</p>
<p>We define the <span class="math inline">\(n\)</span>-by-<span class="math inline">\(m\)</span> transmission matrix as the
following.</p>
<p><span class="math display">\[
\DeclareMathOperator{\diag}{diag}
T = \diag(p) B \diag(c)
\]</span></p>
<p>An alternative way to write this equation – that I prefer because it
is a better representation of the actual computations – is using <a href="https://canmod.github.io/macpan2/articles/elementwise_binary_operators.html">element-wise
operations</a>. If <span class="math inline">\(\circ\)</span> is the
element-wise product then we have the following.</p>
<p><span class="math display">\[
T = p \circ B \circ c^\top
\]</span></p>
<p>The vector containing the per-capita flow rates out of each of the
<span class="math inline">\(s\)</span> states is the following.</p>
<p><span class="math display">\[
\lambda = Tx
\]</span></p>
<p>And finally the absolute flow rates out of each of the <span class="math inline">\(s\)</span> states is the following.</p>
<p><span class="math display">\[
\DeclareMathOperator{\diag}{diag}
r = \lambda \circ s = \left(Tx\right) \circ s = \left(\left(p \circ B
\circ c^\top\right) x\right) \circ s
\]</span></p>
<p>This decomposition involves the following terms.</p>
<ul>
<li>
<span class="math inline">\(p\)</span> – length-<span class="math inline">\(n\)</span> vector of <em>susceptibilities</em> for
each <span class="math inline">\(s\)</span> state</li>
<li>
<span class="math inline">\(B\)</span> – <span class="math inline">\(n\)</span>-by-<span class="math inline">\(m\)</span> matrix of <em>contacts</em> between
each <span class="math inline">\(x\)</span> and <span class="math inline">\(s\)</span> state</li>
<li>
<span class="math inline">\(c\)</span> – length-<span class="math inline">\(m\)</span> vector of <em>infectivities</em> for
each <span class="math inline">\(x\)</span> state</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-sir">Example – SIR<a class="anchor" aria-label="anchor" href="#example-sir"></a>
</h2>
<p>The <span class="math inline">\(s\)</span> vector contains a single
state, <code>S</code>, and <span class="math inline">\(x\)</span>
contains only <code>I</code>. In this case both <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span> are 1, and so all components are 1-by-1
as follows.</p>
<ul>
<li>
<span class="math inline">\(p = 1\)</span> – susceptibility</li>
<li>
<span class="math inline">\(B = 1\)</span> – contact matrix</li>
<li>
<span class="math inline">\(c = \frac{\sigma}{N}\)</span> –
infectivity</li>
</ul>
<p>Therefore we have the following transmission matrix, per-capita flow
rate vector, and absolute flow rate vector.</p>
<ul>
<li><span class="math inline">\(T = \frac{\sigma}{N}\)</span></li>
<li><span class="math inline">\(\lambda = \frac{\sigma}{N}
I\)</span></li>
<li><span class="math inline">\(r = \frac{\sigma}{N} IS\)</span></li>
</ul>
<p>In this example we could have decided to put <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\frac{1}{N}\)</span> in any of the components,
<span class="math inline">\(p\)</span>, <span class="math inline">\(B\)</span>, or <span class="math inline">\(c\)</span>. The point is that we have a somewhat
mechanistic and somewhat general decomposition of transmission, so that
when we start working with more complex models by combining model
modules (e.g. combining SEIR with age and spatial structure) we have a
way to conveniently combine these modules so that the resulting
transmission rates make mechanistic sense. The next example takes one
more step towards this complexity.</p>
</div>
<div class="section level2">
<h2 id="product-models">Product Models<a class="anchor" aria-label="anchor" href="#product-models"></a>
</h2>
<p>Now we consider two models, each with the following triples.</p>
<p><span class="math display">\[
(p_1, B_1, c_1)
\]</span></p>
<p><span class="math display">\[
(p_2, B_2, c_2)
\]</span></p>
<p>Note that these subscripts represent the model, not the components of
these vectors and matrices. The dimensions of the two models is <span class="math inline">\(n_1, m_1\)</span> and <span class="math inline">\(n_2, m_2\)</span>.</p>
<p>Taking the product of these two models results in the following
triple.</p>
<p><span class="math display">\[
(p, B, c) = (p_1\otimes p_2, B_1\otimes B_2, c_1\otimes c_2)
\]</span></p>
<p>Where <span class="math inline">\(\otimes\)</span> is the Kronecker
product. This leads to an <span class="math inline">\(n_1n_2\)</span>-by-1 column vector, <span class="math inline">\(p\)</span>, <span class="math inline">\(n_1n_2\)</span>-by-<span class="math inline">\(m_1m_2\)</span> matrix, <span class="math inline">\(B\)</span>, and <span class="math inline">\(m_1m_2\)</span>-by-1 column vector <span class="math inline">\(c\)</span>.</p>
<p>We also have <span class="math inline">\(x_1, x_2\)</span> and <span class="math inline">\(s_1, s_2\)</span> to combine into <span class="math inline">\(x\)</span> and <span class="math inline">\(s\)</span>. Before doing this we need to make a
distinction between factor models with transmission and those without.
For example, the SIR model clearly has transmission, but a factor model
with just age groups does not. Because a pure age model does not
distinguish between infectious and susceptible people, the only process
that it considers is aging. Nevertheless when the age model becomes
combined with a</p>
</div>
<div class="section level2">
<h2 id="example-sir-time-age">Example – SIR time age<a class="anchor" aria-label="anchor" href="#example-sir-time-age"></a>
</h2>
<p>We take the product of the SIR model above with a two-age-group
module.</p>
<p>Immediately we see an asymmetry. The age-group model has two states,
young and old, neither of which can be classified as either susceptible
or infectious. Both young and old states will have infectious and
susceptible compartments in the combined product model. This means that
the young and old states both play infectious and susceptible roles, and
so both states need to be in <span class="math inline">\(s\)</span> and
<span class="math inline">\(x\)</span>.</p>
</div>
<div class="section level2">
<h2 id="sir-with-multiple-infection-status-times-age">SIR with multiple infection status’ times age<a class="anchor" aria-label="anchor" href="#sir-with-multiple-infection-status-times-age"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Walker, Darren Flynn-Primrose, Weiguang Guan, Ben Bolker, Steve Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
