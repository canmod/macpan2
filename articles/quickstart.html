<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="macpan2">
<title>Quickstart Guide: specifying and simulating a simple compartmental model • macpan2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quickstart Guide: specifying and simulating a simple compartmental model">
<meta property="og:description" content="macpan2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/composing_simulation_models.html">Composing Related Simulation Models</a>
    <a class="dropdown-item" href="../articles/cpp_side.html">The C++ Side</a>
    <a class="dropdown-item" href="../articles/elementwise_binary_operators.html">Elementwise Binary Operators in the McMasterPandemic Engine</a>
    <a class="dropdown-item" href="../articles/functions.html">Mathematical Functions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/hello_products.html">Hello Products</a>
    <a class="dropdown-item" href="../articles/model_definitions.html">Model Definitions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/quickstart.html">Quickstart Guide: specifying and simulating a simple compartmental model</a>
    <a class="dropdown-item" href="../articles/quickstart2.html">Quickstart Guide, part 2: specifying and simulating a structured compartmental model</a>
    <a class="dropdown-item" href="../articles/state_dependent_rates.html">State-Dependent Rates</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quickstart Guide: specifying and simulating a simple compartmental model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/canmod/macpan2/blob/HEAD/vignettes/quickstart.Rmd" class="external-link"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart.Rmd</code></div>
    </div>

    
    
<p><a href="https://img.shields.io/badge/status-working%20draft-red" class="external-link"><img src="https://img.shields.io/badge/status-working%20draft-red" alt="status"></a></p>
<p>This quickstart guide is meant to show a new user how to specify and
simulate a simple compartmental model in <code>macpan2</code>.</p>
<p><code>macpan2</code> is extremely flexible in how models are
specified, and so there can be several equivalent ways of specifying the
same model. This feature is important to keep in mind when trying to
understand or build more complicated models, such as the one
demonstrated in Quickstart Guide, part 2 (see
<code><a href="../articles/quickstart2.html">vignette('quickstart2', package = 'macpan2')</a></code>).</p>
<div class="section level2">
<h2 id="model-definition-files">Model Definition Files<a class="anchor" aria-label="anchor" href="#model-definition-files"></a>
</h2>
<p>Models are defined by a set of four <a href="https://canmod.github.io/macpan2/articles/model_definitions">model
definition files</a>, all housed in the same directory:</p>
<pre><code>model_name
├── variables.csv
├── derivations.json
├── settings.json
└── flows.csv</code></pre>
<p>Installations of <code>macpan2</code> contain several starter
models:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"starter_models"</span>, package <span class="op">=</span> <span class="st">"macpan2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "age"             "macpan_base"     "seir"            "seir_simplified"</span></span>
<span><span class="co">#&gt;  [5] "seir_symp"       "seir_symp_vax"   "seir_vax"        "SI_products"    </span></span>
<span><span class="co">#&gt;  [9] "sir"             "testing"         "vax"</span></span></code></pre></div>
<p>TODO: add a link to a reference doc with short descriptions of each
starter model… also write this doc :) ideally it would have diagrams to
illustrate each model</p>
<p>The simplest is an SIR model, which can be found in this
directory:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sir_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"starter_models"</span>, <span class="st">"sir"</span>, package <span class="op">=</span> <span class="st">"macpan2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/macpan2/starter_models/sir"</span></span></code></pre></div>
<p>IP: before getting into the files below, it would be worth showing
the user a diagram of the model (and especially if there’s a diagram
utility, it could be demonstrated here)</p>
<p>(BB: do we want this? Start a <code>macpan_helpers</code>
package?)</p>
<p>In this article, we work through the specification and simulation of
the SIR sample model.</p>
<div class="section level3">
<h3 id="variables">variables.csv<a class="anchor" aria-label="anchor" href="#variables"></a>
</h3>
<p><code>variables.csv</code> includes a list of the model
variables:</p>
<pre><code><span><span class="co">#&gt; Epi</span></span>
<span><span class="co">#&gt; S</span></span>
<span><span class="co">#&gt; I</span></span>
<span><span class="co">#&gt; R</span></span>
<span><span class="co">#&gt; N</span></span>
<span><span class="co">#&gt; beta</span></span>
<span><span class="co">#&gt; foi</span></span>
<span><span class="co">#&gt; gamma</span></span></code></pre>
<p>(The first row of this file is a header row, which classifies the
variables below. More on this later.)</p>
<p>In <code>macpan2</code>, we use “variables” as a general term to
refer to</p>
<ul>
<li>
<strong>state variables</strong>, such as:
<ul>
<li>
<code>S</code>: the number of susceptible individuals at each point
in time</li>
<li>
<code>I</code>: the number of infectious individuals</li>
<li>
<code>R</code>: the number of removed individuals</li>
</ul>
</li>
<li>
<strong>parameters</strong>, such as:
<ul>
<li>
<code>beta</code>: the contact rate (transmission per time per
susceptible per infective)</li>
<li>
<code>gamma</code>: the per-capita recovery rate of infectious
individuals</li>
</ul>
</li>
<li>
<strong>derived variables</strong>, to be calculated using state
variables and/or parameters, such as:
<ul>
<li>
<code>N</code>: population size, calculated by summing all of the
state variables <code>S + I + R</code>
</li>
<li>
<code>foi</code>: the force of infection, <code>beta * I / N</code>
in this model</li>
</ul>
</li>
</ul>
<p>Formulas for the derived quantities are defined in <a href="#derivations">derivations.json</a>.</p>
<p>In simple models like this one, <code>variables.csv</code> is a
single-column <code>.csv</code> file. The header row contains one column
name, <code>Epi</code>, which labels the variables below it as
epidemiological variables. Such variable category labels, or
<strong>variable partitions</strong>, aren’t useful for simple models
like the basic SIR, which have only a single variable category. However,
partitions are essential as part of <a href="https://canmod.github.io/macpan2/articles/hello_products.html">“product”
models</a> that combine multiple model structures into more complex
models (for example, an SEIR model where the infectious class is divided
by level of symptoms: see
<code><a href="../articles/quickstart2.html">vignette('quickstart2', package = 'macpan2')</a></code>.</p>
</div>
<div class="section level3">
<h3 id="derivations">derivations.json<a class="anchor" aria-label="anchor" href="#derivations"></a>
</h3>
<p><code>derivations.json</code> includes expressions for computing
derived variables:</p>
<pre><code><span><span class="co">#&gt; [</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "output_names" : ["N"],</span></span>
<span><span class="co">#&gt;     "simulation_phase" : "before",</span></span>
<span><span class="co">#&gt;     "arguments" : ["S", "I", "R"],</span></span>
<span><span class="co">#&gt;     "expression" : "sum(S, I, R)"</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "output_names" : ["foi"],</span></span>
<span><span class="co">#&gt;     "simulation_phase" : "during_pre_update",</span></span>
<span><span class="co">#&gt;     "arguments" : ["I", "beta", "N"],</span></span>
<span><span class="co">#&gt;     "expression" : "I * beta / N"</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; ]</span></span></code></pre>
<p>In this example, the derived variables are the total population size,
<code>N</code>, and the force of infection, <code>foi</code>. Each
derived variable is defined in a <a href="https://en.wikipedia.org/wiki/JSON" class="external-link">JSON</a> object. Each such
JSON object will contain several key-value pairs. Here the keys are:</p>
<ul>
<li>
<code>output_names</code>: the name(s) of the derived variable(s);
in this simple model, each JSON object only defines a single derived
variable</li>
<li>
<code>simulation_phase</code>: the phase during which this derived
variable is calculated; here we have
<ul>
<li>
<code>"before"</code>, which means the variable is calculated from
the initial variable values, before the simulation begins</li>
<li>
<code>"during_pre_update"</code>, which means the variable is
calculated at each simulation step, before the state variables are
updated for the next time step</li>
</ul>
</li>
<li>
<code>arguments</code>: an array of the variables (delimited by
brackets <code>[]</code>) used to calculate the derived variable</li>
<li>
<code>expression</code>: a string storing a mathematical expression
used to calculate the derived variable using the
<code>arguments</code>
</li>
</ul>
<p>The keys described above have more options; supplementary keys are
used for defining more complicated models. These are fully catalogued in
the <a href="https://canmod.github.io/macpan2/articles/model_definitions.html#flow-between-compartments">model
definitions</a> article. Mathematical operations and functions available
to use in the <code>expression</code> string are listed in the <a href="https://canmod.github.io/macpan2/reference/engine_functions.html">engine
functions</a> reference article.</p>
<p>(BB: is it worth mentioning that (1) we could have defined
<code>foi</code> as <code>beta*I/(S+I+R)</code>, but that (a) it would
be harder to read and (b) it would be less efficient since we would be
computing <code>N</code> at every time step? and (2) that in a model
where <code>N</code> varied over time we would need to compute
<code>N</code> “during_pre_update” rather than “before”? Or are these
unnecessary details at this stage?)</p>
</div>
<div class="section level3">
<h3 id="settings-json">settings.json<a class="anchor" aria-label="anchor" href="#settings-json"></a>
</h3>
<p><code>settings.json</code> gives information about how to interpret
the variables defined in <a href="#variables">variables.csv</a>.</p>
<p>IP: the old version of this paragraph started with</p>
<blockquote>
<p>The next file is <code>settings.json</code>, which has information
about how to interpret the variables and flows. In simple models like
this, the two relevant fields are a list of state variables (those that
can appear in the from and to columns of flows.csv) and another list of
flow variables (those that can appear in the flow column of
flows.csv).</p>
</blockquote>
<p>IP: I’ve tried to simplify this by saying that
<code>settings.json</code> gives info about variables in
<code>variables.csv</code> (as opposed to additionally referring to
<code>flows.csv</code>), and that’s also why I’ve put this section
directly after <code>variables.csv</code>. While it’s possible to just
reference variables in <code>variables.csv</code> to explain
<code>settings.json</code> for this atomic model, I’m not sure if it
also holds true for product models, but I think it’s OK if we gloss over
that here.</p>
<pre><code><span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "required_partitions" : ["Epi"],</span></span>
<span><span class="co">#&gt;   "null_partition" : "Null",</span></span>
<span><span class="co">#&gt;   "state_variables" : ["S", "I", "R"],</span></span>
<span><span class="co">#&gt;   "flow_variables" : ["foi", "gamma"]</span></span>
<span><span class="co">#&gt; }</span></span></code></pre>
<p>This file contains a single JSON object, with several key-value
pairs. The mandatory keys are:</p>
<ul>
<li>
<code>required_partitions</code>: an array of variable partition
names (from the header row of <a href="#variables">variables.csv</a>)
required to uniquely identify each variable</li>
<li>
<code>null_partition</code>: leave this entry as
<code>"Null"</code>; this key may be used to expand
<code>macpan2</code>’s functionality in the future, but it is currently
unused</li>
<li>
<code>state_variables</code>: an array of state variables</li>
<li>
<code>flow_variables</code>: an array of flow variables</li>
</ul>
</div>
<div class="section level3">
<h3 id="flows-csv">flows.csv<a class="anchor" aria-label="anchor" href="#flows-csv"></a>
</h3>
<p><code>flows.csv</code> defines flows between state variable
compartments:</p>
<pre><code><span><span class="co">#&gt; from ,to ,flow  ,type      </span></span>
<span><span class="co">#&gt; S    ,I  ,foi   ,per_capita</span></span>
<span><span class="co">#&gt; I    ,R  ,gamma ,per_capita</span></span></code></pre>
<p>This file also starts with a header row, including the following
columns:</p>
<ul>
<li>
<code>from</code>: the name of the compartment where the flow comes
from</li>
<li>
<code>to</code>: the name of the compartment where the flow goes
to</li>
<li>
<code>flow</code>: the variable name storing the value of the flow
rate</li>
<li>
<code>type</code>: the type of the flow</li>
</ul>
<p>(BB: “origin” and “destination” compartments instead of “where the
flow (comes from|goes to)”? or is that too fancy?)</p>
<p>Here, the flow type is <code>per_capita</code>: i.e., the flow at
time step <span class="math inline">\(t+1\)</span> will equal
<code>flow</code> times the number of individuals in the
<code>from</code> compartment at time <span class="math inline">\(t\)</span>. In the example above, the flow from
<code>S</code> to <code>I</code> equals <code>foi * S</code> (referring
back to the derivations file, this is equal to
<code>beta * S * I/ N</code>).</p>
<p>All available flow types are given in the <a href="https://canmod.github.io/macpan2/articles/model_definitions.html#flow-between-compartments">model
definitions</a> article.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-model-definitions-into-r">Getting Model Definitions into R<a class="anchor" aria-label="anchor" href="#getting-model-definitions-into-r"></a>
</h2>
<p>Once we have a directory that completely defines a compartmental
model, the definition can be loaded into R using the
<code>Compartmental</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir</span> <span class="op">=</span> <span class="fu"><a href="../reference/Compartmental.html">Compartmental</a></span><span class="op">(</span><span class="va">sir_dir</span><span class="op">)</span></span></code></pre></div>
<p>This <code>sir</code> object contains several methods for working
with the model. The most important of these is the
<code>simulators_tmb</code> method, which is described in the next
section.</p>
</div>
<div class="section level2">
<h2 id="numerical-inputs">Numerical Inputs<a class="anchor" aria-label="anchor" href="#numerical-inputs"></a>
</h2>
<p>The model definition does not contain any numerical quantities and so
it is not sufficient for running a simulation. The
<code>$simulators$tmb</code> method allows you to create a model engine,
which can be used to run simulations, by specifying numerical values for
key quantities. Here we specify an engine called
<code>sir_simulator</code> by providing the following information.</p>
<ul>
<li>
<code>time_steps</code> – How many time steps should the epidemic
simulator run for?</li>
<li>
<code>state</code> – A named vector containing the initial values of
the state variables defined in <code>settings.json</code>.</li>
<li>
<code>flow</code> – A named vector containing the values of the flow
variables defined in <code>settings.json</code>.</li>
<li>
<code>...</code> – Any other named variables that are required for
your model definition, i.e. quantities used in the model that are not
defined in <code>derivations.json</code>. In this example
<code>beta</code> and <code>N</code> are required.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_simulator</span> <span class="op">=</span> <span class="va">sir</span><span class="op">$</span><span class="va">simulators</span><span class="op">$</span><span class="fu">tmb</span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">100</span></span>
<span>  , state <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">99</span>, I <span class="op">=</span> <span class="fl">1</span>, R <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  , flow <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>foi <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  , beta <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  , N <span class="op">=</span> <span class="va">empty_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>To generate simulations from the simulator, use the
<code>report</code> method. The results come out in <a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data" class="external-link">long
format</a> and always have the same columns.</p>
<p>(BB: I know the wikipedia page says “wide and narrow”, but “long
format” seems more common IME.)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_simulations</span> <span class="op">=</span> <span class="va">sir_simulator</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sir_simulations</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="co">#&gt;   matrix time row col     value</span></span>
<span><span class="co">#&gt; 1  state    0   S     99.000000</span></span>
<span><span class="co">#&gt; 2  state    0   I      1.000000</span></span>
<span><span class="co">#&gt; 3  state    0   R      0.000000</span></span>
<span><span class="co">#&gt; 4  state    1   S     98.802000</span></span>
<span><span class="co">#&gt; 5  state    1   I      1.098000</span></span>
<span><span class="co">#&gt; 6  state    1   R      0.100000</span></span>
<span><span class="co">#&gt; 7  state    2   S     98.585031</span></span>
<span><span class="co">#&gt; 8  state    2   I      1.205169</span></span>
<span><span class="co">#&gt; 9  state    2   R      0.209800</span></span></code></pre></div>
<p>All variables in the simulations are <a href="https://canmod.github.io/macpan2/articles/cpp_side#matrices">matrix
valued</a> – even ordinary numbers are stored as 1-by-1 matrices. The
first column in the output gives the name of the matrix being returned.
Here we see the default behaviour of returning only the state matrix (or
vector). This can be modified with the <code>.mats_to_save</code> and
<code>.mats_to_return</code> arguments to the
<code>$simulators_tmb</code> method (TODO: clean up and point to
documentation). (BB: not entirely clear …)</p>
<p>The second column, <code>time</code>, gives the time step being
reported. The third and fourth columns give the row and column
identifiers within each reported matrix (in this example there is only
one reported matrix, <code>state</code>, and our column identifier is
filled with blanks since our <code>state</code> matrix has only one
row). The final column gives the simulated values.</p>
</div>
<div class="section level2">
<h2 id="processing-results">Processing Results<a class="anchor" aria-label="anchor" href="#processing-results"></a>
</h2>
<p>There are no plotting tools in <code>macpan2</code>. The philosophy
is to focus on the engine and modelling interface. We are not going to
do better than <code>ggplot2</code> at plotting, for example, so we
format the output so that it can be easily manipulated in
<code>ggplot2</code>. For example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sir_simulations</span></span>
<span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span></span>
<span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">row</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart_files/figure-html/ggplot_ex-1.png" width="576"></p>
<p>Similarly, if you want to convert the long-format data to wide
format, you can use standard R tools:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sir_simulations</span></span>
<span>    <span class="co">## drop 'matrix' (has only a single value) and 'column' (blank)</span></span>
<span>    <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">|&gt;</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">time</span>, names_from <span class="op">=</span> <span class="va">row</span><span class="op">)</span></span>
<span>    <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;    time     S     I     R</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0  99    1    0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1  98.8  1.10 0.1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2  98.6  1.21 0.210</span></span></code></pre></div>
<p>(BB: any further examples here, or is this enough?)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Walker, Darren Flynn-Primrose, Weiguang Guan, Ben Bolker, Steve Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
