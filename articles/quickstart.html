<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="macpan2">
<title>Quickstart Guide • macpan2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quickstart Guide">
<meta property="og:description" content="macpan2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/composing_simulation_models.html">Composing Related Simulation Models</a>
    <a class="dropdown-item" href="../articles/cpp_side.html">The C++ Side of McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/elementwise_binary_operators.html">Elementwise Binary Operators in the McMasterPandemic Engine</a>
    <a class="dropdown-item" href="../articles/functions.html">Mathematical Functions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/hello_products.html">Hello Products</a>
    <a class="dropdown-item" href="../articles/model_definitions.html">Model Definitions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/quickstart.html">Quickstart Guide</a>
    <a class="dropdown-item" href="../articles/state_dependent_rates.html">State-Dependent Rates</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quickstart Guide</h1>
            
      
      
      <div class="d-none name"><code>quickstart.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="model-definition-files">Model Definition Files<a class="anchor" aria-label="anchor" href="#model-definition-files"></a>
</h2>
<p>Models are defined by a set of four <a href="https://canmod.github.io/macpan2/articles/model_definitions">model
definition files</a>. Installations of <code>macpan2</code> contain
several starter models for illustration. The simplest is an SIR model,
with a path that can be obtained as follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sir_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"starter_models"</span>, <span class="st">"sir"</span>, package <span class="op">=</span> <span class="st">"macpan2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/macpan2/starter_models/sir"</span></span></code></pre></div>
<p>The first of these files is <code>variables.csv</code>, which
provides a list of the variables in the model.</p>
<pre><code><span><span class="co">#&gt; Epi</span></span>
<span><span class="co">#&gt; S</span></span>
<span><span class="co">#&gt; I</span></span>
<span><span class="co">#&gt; R</span></span>
<span><span class="co">#&gt; N</span></span>
<span><span class="co">#&gt; beta</span></span>
<span><span class="co">#&gt; foi</span></span>
<span><span class="co">#&gt; gamma</span></span></code></pre>
<p>TODO: describe the meaning of each variable in this case.</p>
<p>In simple models like this, <code>variables.csv</code> is a
single-column CSV file. In this case the name of the column is
<code>Epi</code>, which isn’t particularly useful in this case. However,
in more complex structured models there could be many columns with names
like <code>Epi</code>, <code>Age</code>, and <code>Location</code>. In
this quickstart guide we focus on simple unstructured models.</p>
<p>The second file is <code>flows.csv</code>, which defines flows
between compartments.</p>
<pre><code><span><span class="co">#&gt; from ,to ,flow  ,type      </span></span>
<span><span class="co">#&gt; S    ,I  ,foi   ,per_capita</span></span>
<span><span class="co">#&gt; I    ,R  ,gamma ,per_capita</span></span></code></pre>
<p>TODO: describe columns of flows.csv.</p>
<p>TODO: note that in structured models more columns are required.</p>
<p>The next file is <code>settings.json</code>, which has information
about how to interpret the variables and flows. In simple models like
this, the two relevant fields are a list of state variables (those that
can appear in the <code>from</code> and <code>to</code> columns of
<code>flows.csv</code>) and another list of flow variables (those that
can appear in the <code>flow</code> column of
<code>flows.csv</code>).</p>
<pre><code><span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "required_partitions" : ["Epi"],</span></span>
<span><span class="co">#&gt;   "null_partition" : "Null",</span></span>
<span><span class="co">#&gt;   "state_variables" : ["S", "I", "R"],</span></span>
<span><span class="co">#&gt;   "flow_variables" : ["foi", "gamma"]</span></span>
<span><span class="co">#&gt; }</span></span></code></pre>
<p>The final file, <code>derivations.json</code>, describes a list of
expressions for computing derived variables.</p>
<pre><code><span><span class="co">#&gt; [</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "simulation_phase" : "before",</span></span>
<span><span class="co">#&gt;     "output_names" : ["N"],</span></span>
<span><span class="co">#&gt;     "arguments" : ["S", "I", "R"],</span></span>
<span><span class="co">#&gt;     "expression" : "sum(S, I, R)"</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "simulation_phase" : "during_pre_update",</span></span>
<span><span class="co">#&gt;     "output_names" : ["foi"],</span></span>
<span><span class="co">#&gt;     "arguments" : ["I", "beta", "N"],</span></span>
<span><span class="co">#&gt;     "expression" : "I * beta / N"</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; ]</span></span></code></pre>
<p>In this example, the derived variables are the total population size,
<code>N</code>, and the force of infection, <code>foi</code>.</p>
<p>TODO: describe the details of the fields in this file.</p>
</div>
<div class="section level2">
<h2 id="getting-model-definitions-into-r">Getting Model Definitions into R<a class="anchor" aria-label="anchor" href="#getting-model-definitions-into-r"></a>
</h2>
<p>Once a directory that defines a compartmental model is produced, the
definition can be loaded into R using the <code>Compartmental</code>
function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir</span> <span class="op">=</span> <span class="fu"><a href="../reference/Compartmental.html">Compartmental</a></span><span class="op">(</span><span class="va">sir_dir</span><span class="op">)</span></span></code></pre></div>
<p>This <code>sir</code> object contains several methods for working
with the model. The most important of these is the
<code>simulators_tmb</code> method, which is described in the next
section.</p>
</div>
<div class="section level2">
<h2 id="numerical-inputs">Numerical Inputs<a class="anchor" aria-label="anchor" href="#numerical-inputs"></a>
</h2>
<p>The model definition does not contain any numerical quantities and so
it is not sufficient for running a simulation. The
<code>$simulators$tmb</code> method allows one to create a model engine,
which can be used to run simulations, by specifying numerical values for
key quantities. Here we specify an engine called
<code>sir_simulator</code> by providing the following information.</p>
<ul>
<li>
<code>time_steps</code> – How many time steps should the epidemic
simulator run for?</li>
<li>
<code>state</code> – A named vector containing the values of the
state variables defined in <code>settings.json</code>.</li>
<li>
<code>flow</code> – A named vector containing the values of the flow
variables defined in <code>settings.json</code>.</li>
<li>
<code>...</code> – Any other named variables that are required of
your model definition, because they are not derived quantities specified
in <code>derivations.json</code>. In this example we have
<code>beta</code> and <code>N</code> that are required.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_simulator</span> <span class="op">=</span> <span class="va">sir</span><span class="op">$</span><span class="va">simulators</span><span class="op">$</span><span class="fu">tmb</span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">100</span></span>
<span>  , state <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">99</span>, I <span class="op">=</span> <span class="fl">1</span>, R <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  , flow <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>foi <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  , beta <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  , N <span class="op">=</span> <span class="va">empty_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>To generate simulations from the simulator, one uses the
<code>report</code> method. The results come out in <a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data" class="external-link">narrow
format</a> and always have the same columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_simulations</span> <span class="op">=</span> <span class="va">sir_simulator</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sir_simulations</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;    matrix time row col      value</span></span>
<span><span class="co">#&gt; 1   state    0   S     99.0000000</span></span>
<span><span class="co">#&gt; 2   state    0   I      1.0000000</span></span>
<span><span class="co">#&gt; 3   state    0   R      0.0000000</span></span>
<span><span class="co">#&gt; 4   state    1   S     98.8020000</span></span>
<span><span class="co">#&gt; 5   state    1   I      1.0980000</span></span>
<span><span class="co">#&gt; 6   state    1   R      0.1000000</span></span>
<span><span class="co">#&gt; 7   state    2   S     98.5850308</span></span>
<span><span class="co">#&gt; 8   state    2   I      1.2051692</span></span>
<span><span class="co">#&gt; 9   state    2   R      0.2098000</span></span>
<span><span class="co">#&gt; 10  state    3   S     98.3474075</span></span>
<span><span class="co">#&gt; 11  state    3   I      1.3222756</span></span>
<span><span class="co">#&gt; 12  state    3   R      0.3303169</span></span>
<span><span class="co">#&gt; 13  state    4   S     98.0873228</span></span>
<span><span class="co">#&gt; 14  state    4   I      1.4501327</span></span>
<span><span class="co">#&gt; 15  state    4   R      0.4625445</span></span>
<span><span class="co">#&gt; 16  state    5   S     97.8028435</span></span>
<span><span class="co">#&gt; 17  state    5   I      1.5895987</span></span>
<span><span class="co">#&gt; 18  state    5   R      0.6075577</span></span>
<span><span class="co">#&gt; 19  state    6   S     97.4919089</span></span>
<span><span class="co">#&gt; 20  state    6   I      1.7415734</span></span></code></pre></div>
<p>All variables in the simulations are <a href="https://canmod.github.io/macpan2/articles/cpp_side#matrices">matrix
valued</a> – even ordinary numbers are stored as 1-by-1 matrices. The
first column in the output gives you the name of the matrix being
returned. Here we see the default behaviour of returning only the state
matrix (or vector). This can be modified with the
<code>.mats_to_save</code> and <code>.mats_to_return</code> arguments to
the <code>$simulators_tmb</code> method (TODO: clean up and point to
documentation).</p>
<p>The second column, <code>time</code>, gives the time step being
reported. The third and fouth columns give the row and column
identifiers within each matrices being reported on. The final column
gives each simulated value.</p>
</div>
<div class="section level2">
<h2 id="processing-results">Processing Results<a class="anchor" aria-label="anchor" href="#processing-results"></a>
</h2>
<p>There are no plotting tools in <code>macpan2</code>. The philosophy
is to focus on the engine and modelling interface. We are not going to
do better than <code>ggplot2</code> at plotting, for example, so we just
format the output so that it can be easily manipulated by someone who
has learned <code>ggplot2</code>. Here is an example.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sir_simulations</span></span>
<span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span></span>
<span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">row</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Walker, Darren Flynn-Primrose, Weiguang Guan, Ben Bolker, Steve Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
