<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="macpan2">
<title>Hello Products • macpan2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hello Products">
<meta property="og:description" content="macpan2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/composing_simulation_models.html">Composing Related Simulation Models</a>
    <a class="dropdown-item" href="../articles/cpp_side.html">The C++ Side of McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/elementwise_binary_operators.html">Elementwise Binary Operators in the McMasterPandemic Engine</a>
    <a class="dropdown-item" href="../articles/functions.html">Mathematical Functions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/hello_products.html">Hello Products</a>
    <a class="dropdown-item" href="../articles/model_definitions.html">Model Definitions in McMasterPandemic</a>
    <a class="dropdown-item" href="../articles/quickstart.html">Quickstart Guide</a>
    <a class="dropdown-item" href="../articles/state_dependent_rates.html">State-Dependent Rates</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Hello Products</h1>
            
      
      
      <div class="d-none name"><code>hello_products.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="read-models">Read Models<a class="anchor" aria-label="anchor" href="#read-models"></a>
</h2>
<p>Here we read the target product model, <code>prod</code>, and its two
factor models, <code>si</code> and <code>age</code>, into R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prod</span> <span class="op">=</span> <span class="fu"><a href="../reference/Compartmental.html">Compartmental</a></span><span class="op">(</span><span class="va">prod_dir</span><span class="op">)</span></span>
<span><span class="va">si</span> <span class="op">=</span> <span class="fu"><a href="../reference/Compartmental.html">Compartmental</a></span><span class="op">(</span><span class="va">si_dir</span><span class="op">)</span></span>
<span><span class="va">age</span> <span class="op">=</span> <span class="fu"><a href="../reference/Compartmental.html">Compartmental</a></span><span class="op">(</span><span class="va">age_dir</span><span class="op">)</span></span></code></pre></div>
<p>The goal of this document is to multiply <code>si</code> and
<code>age</code> to see if we can recover our target,
<code>prod</code>.</p>
</div>
<div class="section level2">
<h2 id="simulating-from-the-product-model">Simulating from the Product Model<a class="anchor" aria-label="anchor" href="#simulating-from-the-product-model"></a>
</h2>
<p>TODO:</p>
<ul>
<li>Do the model definition by hand so that it works</li>
<li>Specify numerical inputs</li>
<li>Run the the simulation</li>
<li>Verify the results</li>
</ul>
</div>
<div class="section level2">
<h2 id="multiplying-variable-lists">Multiplying Variable Lists<a class="anchor" aria-label="anchor" href="#multiplying-variable-lists"></a>
</h2>
<p>We begin taking the product of <code>si</code> and <code>age</code>
by multiplying the variables, which are as follows for the factor
models.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">si</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Epi</span></span>
<span><span class="co">#&gt; 1              S</span></span>
<span><span class="co">#&gt; 2              I</span></span>
<span><span class="co">#&gt; 3              N</span></span>
<span><span class="co">#&gt; 4      infection</span></span>
<span><span class="co">#&gt; 5         waning</span></span>
<span><span class="co">#&gt; 6 susceptibility</span></span>
<span><span class="co">#&gt; 7        contact</span></span>
<span><span class="co">#&gt; 8    infectivity</span></span>
<span><span class="va">age</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Age</span></span>
<span><span class="co">#&gt; 1 young</span></span>
<span><span class="co">#&gt; 2   old</span></span>
<span><span class="co">#&gt; 3 aging</span></span></code></pre></div>
<p>The simple Cartesian product of these two lists is as follows.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Epi   Age</span></span>
<span><span class="co">#&gt; 1               S young</span></span>
<span><span class="co">#&gt; 2               I young</span></span>
<span><span class="co">#&gt; 3               N young</span></span>
<span><span class="co">#&gt; 4       infection young</span></span>
<span><span class="co">#&gt; 5          waning young</span></span>
<span><span class="co">#&gt; 6  susceptibility young</span></span>
<span><span class="co">#&gt; 7         contact young</span></span>
<span><span class="co">#&gt; 8     infectivity young</span></span>
<span><span class="co">#&gt; 9               S   old</span></span>
<span><span class="co">#&gt; 10              I   old</span></span>
<span><span class="co">#&gt; 11              N   old</span></span>
<span><span class="co">#&gt; 12      infection   old</span></span>
<span><span class="co">#&gt; 13         waning   old</span></span>
<span><span class="co">#&gt; 14 susceptibility   old</span></span>
<span><span class="co">#&gt; 15        contact   old</span></span>
<span><span class="co">#&gt; 16    infectivity   old</span></span>
<span><span class="co">#&gt; 17              S aging</span></span>
<span><span class="co">#&gt; 18              I aging</span></span>
<span><span class="co">#&gt; 19              N aging</span></span>
<span><span class="co">#&gt; 20      infection aging</span></span>
<span><span class="co">#&gt; 21         waning aging</span></span>
<span><span class="co">#&gt; 22 susceptibility aging</span></span>
<span><span class="co">#&gt; 23        contact aging</span></span>
<span><span class="co">#&gt; 24    infectivity aging</span></span></code></pre></div>
<p>This is too much. For example, one of the levels of each state
variable (S, I) in the <code>si</code> model is the <code>aging</code>
rate. This doesn’t make sense. Perhaps it would be better to start with
the Cartesian product of the state variables only, and then build up
from there.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Epi   Age</span></span>
<span><span class="co">#&gt; 1   S young</span></span>
<span><span class="co">#&gt; 2   I young</span></span>
<span><span class="co">#&gt; 3   S   old</span></span>
<span><span class="co">#&gt; 4   I   old</span></span></code></pre></div>
<p>That’s better, but it is missing the stratification of the flow rates
and their parameters. For example we want age-stratified
<code>infection</code> rates. To stratify the flows in <code>si</code>
by the states in <code>age</code> we could do the following.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">flow_variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Epi   Age</span></span>
<span><span class="co">#&gt; 1 infection young</span></span>
<span><span class="co">#&gt; 2    waning young</span></span>
<span><span class="co">#&gt; 3 infection   old</span></span>
<span><span class="co">#&gt; 4    waning   old</span></span></code></pre></div>
<p>That’s good. Do we want to stratify the flows in <code>age</code> by
the states in <code>si</code>?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">flow_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Epi   Age</span></span>
<span><span class="co">#&gt; 1   S aging</span></span>
<span><span class="co">#&gt; 2   I aging</span></span></code></pre></div>
<p>Here it doesn’t make sense for <code>S</code> and <code>I</code> to
age at different <code>aging</code> rates. But maybe for the purposes of
‘The Product Model’ this is OK, and the user just needs to set the aging
rate as constant? Not sure.</p>
<p>Putting this all together we have.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/union_vars.html">union_vars</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">flow_variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span><span class="va">si</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span>, <span class="va">age</span><span class="op">$</span><span class="fu">flow_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;          Epi   Age</span></span>
<span><span class="co">#&gt; 1          S young</span></span>
<span><span class="co">#&gt; 2          I young</span></span>
<span><span class="co">#&gt; 3          S   old</span></span>
<span><span class="co">#&gt; 4          I   old</span></span>
<span><span class="co">#&gt; 5  infection young</span></span>
<span><span class="co">#&gt; 6     waning young</span></span>
<span><span class="co">#&gt; 7  infection   old</span></span>
<span><span class="co">#&gt; 8     waning   old</span></span>
<span><span class="co">#&gt; 9          S aging</span></span>
<span><span class="co">#&gt; 10         I aging</span></span></code></pre></div>
<p>But what about other variables that are neither states nor flows? We
can at least list these other variables.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">si</span><span class="op">$</span><span class="fu">other_variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Epi</span></span>
<span><span class="co">#&gt; 1              N</span></span>
<span><span class="co">#&gt; 2 susceptibility</span></span>
<span><span class="co">#&gt; 3        contact</span></span>
<span><span class="co">#&gt; 4    infectivity</span></span>
<span><span class="va">age</span><span class="op">$</span><span class="fu">other_variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in age$other_variables(): </span></span>
<span><span class="co">#&gt; There are no other variables in this model</span></span>
<span><span class="co">#&gt; except for state and flow variables.</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Here we see <code>N</code>, which as we will see later is the sum of
<code>S</code> and <code>I</code>. We also see three variables
(<code>susceptibility</code>, <code>contact</code>, and
<code>infectivity</code>) that <a href="https://canmod.github.io/macpan2/articles/state_dependent_rates">parameterize</a>
the <code>infection</code> rate. Finally we also see that the only
variables in the <code>age</code> model are states and flows.</p>
<p>We want <code>N</code> to be stratified by age, but what about the
infection-related variables? We take one at a time.</p>
<p>The <code>susceptibility</code> parameter is a property of the
<code>from</code> states involved in infection flows. It measures how
susceptible the <code>from</code> state is to being infected. Often
<code>susceptibility</code> will equal <code>1</code> (or some other
constant) if there is only one susceptible state or if all susceptible
states are equally susceptible. But if the susceptible states differ in
their susceptibility (e.g. due to differeneces in vaccination status or
infection history), then the <code>susceptibility</code> parameter will
vary. In our working example we might want to stratify
<code>susceptibility</code> by age so that young people are less
susceptible than old people.</p>
<p>The <code>infectivity</code> parameter is a property of the
infectious states involved in infection flows. As with the
<code>susceptibility</code> parameter, we probably also want to stratify
<code>infectivity</code> by <code>age</code> as well.</p>
<p>The <code>contact</code> parameter is a property of a pair of states
– in particular one susceptible state and one infectious state. Because
all states can be any age and that it is possible for any individual in
one age to interact with an individual in another age, this
<code>contact</code> parameter needs to be stratified by age twice –
first by the susceptible age and then by the infectious age. This
double-stratification makes <code>contact</code> more complex to handle,
because we are not able to just take a single Cartesian product – we
need to take two products.</p>
<p>But before we do any double products, let’s first handle
<code>N</code>, <code>susceptibility</code>, and
<code>infectivity</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span></span>
<span>  <span class="va">si</span><span class="op">$</span><span class="fu">other_variables</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"susceptibility"</span>, <span class="st">"infectivity"</span><span class="op">)</span>, </span>
<span>  <span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;              Epi   Age</span></span>
<span><span class="co">#&gt; 1              N young</span></span>
<span><span class="co">#&gt; 2 susceptibility young</span></span>
<span><span class="co">#&gt; 3    infectivity young</span></span>
<span><span class="co">#&gt; 4              N   old</span></span>
<span><span class="co">#&gt; 5 susceptibility   old</span></span>
<span><span class="co">#&gt; 6    infectivity   old</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cartesian.html">cartesian</a></span><span class="op">(</span></span>
<span>  <span class="va">si</span><span class="op">$</span><span class="fu">other_variables</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="st">"contact"</span><span class="op">)</span>,</span>
<span>  <span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">products</span><span class="op">$</span><span class="fu">cartesian</span><span class="op">(</span><span class="va">age</span><span class="op">$</span><span class="fu">state_variables</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Age     Epi</span></span>
<span><span class="co">#&gt; 1   old contact</span></span>
<span><span class="co">#&gt; 2 young contact</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="aligning-state-dependent-effects-on-flows">Aligning State-Dependent Effects on Flows<a class="anchor" aria-label="anchor" href="#aligning-state-dependent-effects-on-flows"></a>
</h2>
</div>
<div class="section level2">
<h2 id="multiplying-flows">Multiplying Flows<a class="anchor" aria-label="anchor" href="#multiplying-flows"></a>
</h2>
</div>
<div class="section level2">
<h2 id="combining-the-derivations">Combining the Derivations<a class="anchor" aria-label="anchor" href="#combining-the-derivations"></a>
</h2>
</div>
<div class="section level2">
<h2 id="simulating-the-resulting-product-model">Simulating the Resulting Product Model<a class="anchor" aria-label="anchor" href="#simulating-the-resulting-product-model"></a>
</h2>
</div>
<div class="section level2">
<h2 id="scratch">Scratch<a class="anchor" aria-label="anchor" href="#scratch"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prod</span><span class="op">$</span><span class="fu">state_labels</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "S.young." "S.old."   "I.young." "I.old."</span></span>
<span><span class="va">prod</span><span class="op">$</span><span class="fu">flow_labels</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "waning.young."         "waning.old."           "infection.young.young"</span></span>
<span><span class="co">#&gt; [4] "infection.old.young"   "infection.young.old"   "infection.old.old"</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">si</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Epi</span></span>
<span><span class="co">#&gt; 1              S</span></span>
<span><span class="co">#&gt; 2              I</span></span>
<span><span class="co">#&gt; 3              N</span></span>
<span><span class="co">#&gt; 4      infection</span></span>
<span><span class="co">#&gt; 5         waning</span></span>
<span><span class="co">#&gt; 6 susceptibility</span></span>
<span><span class="co">#&gt; 7        contact</span></span>
<span><span class="co">#&gt; 8    infectivity</span></span>
<span><span class="va">si</span><span class="op">$</span><span class="fu">flows_expanded</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   from to      flow       type</span></span>
<span><span class="co">#&gt; 1    S  I infection per_capita</span></span>
<span><span class="co">#&gt; 2    I  S    waning per_capita</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Age</span></span>
<span><span class="co">#&gt; 1 young</span></span>
<span><span class="co">#&gt; 2   old</span></span>
<span><span class="co">#&gt; 3 aging</span></span>
<span><span class="va">age</span><span class="op">$</span><span class="fu">flows_expanded</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    from  to  flow       type</span></span>
<span><span class="co">#&gt; 1 young old aging per_capita</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prod</span><span class="op">$</span><span class="fu">variables</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Epi   Age  Age2  AgeS  AgeI</span></span>
<span><span class="co">#&gt; 1               S young                  </span></span>
<span><span class="co">#&gt; 2               S   old                  </span></span>
<span><span class="co">#&gt; 3               N young       young      </span></span>
<span><span class="co">#&gt; 4               N   old         old      </span></span>
<span><span class="co">#&gt; 5          waning young                  </span></span>
<span><span class="co">#&gt; 6          waning   old                  </span></span>
<span><span class="co">#&gt; 7     infectivity young             young</span></span>
<span><span class="co">#&gt; 8  susceptibility   old         old      </span></span>
<span><span class="co">#&gt; 9  susceptibility young       young      </span></span>
<span><span class="co">#&gt; 10    infectivity   old               old</span></span>
<span><span class="co">#&gt; 11              I young             young</span></span>
<span><span class="co">#&gt; 12              I   old               old</span></span>
<span><span class="co">#&gt; 13        contact young young young young</span></span>
<span><span class="co">#&gt; 14        contact   old young   old young</span></span>
<span><span class="co">#&gt; 15      infection young young young young</span></span>
<span><span class="co">#&gt; 16      infection   old young   old young</span></span>
<span><span class="co">#&gt; 17        contact   old   old   old   old</span></span>
<span><span class="co">#&gt; 18        contact young   old young   old</span></span>
<span><span class="co">#&gt; 19      infection young   old young   old</span></span>
<span><span class="co">#&gt; 20      infection   old   old   old   old</span></span>
<span><span class="va">prod</span><span class="op">$</span><span class="fu">flows_expanded</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       from       to                  flow       type</span></span>
<span><span class="co">#&gt; 1 S.young. I.young. infection.young.young per_capita</span></span>
<span><span class="co">#&gt; 2 S.young. I.young.   infection.young.old per_capita</span></span>
<span><span class="co">#&gt; 3   S.old.   I.old.   infection.old.young per_capita</span></span>
<span><span class="co">#&gt; 4   S.old.   I.old.     infection.old.old per_capita</span></span>
<span><span class="co">#&gt; 5 I.young. S.young.         waning.young. per_capita</span></span>
<span><span class="co">#&gt; 6   I.old.   S.old.           waning.old. per_capita</span></span>
<span><span class="fu"><a href="../reference/UserExpr.html">UserExpr</a></span><span class="op">(</span><span class="va">prod</span><span class="op">)</span><span class="op">$</span><span class="fu">expand_vector_expressions</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$output_names</span></span>
<span><span class="co">#&gt; [1] "N.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$expression</span></span>
<span><span class="co">#&gt; [1] "sum(state[0], state[1])"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$arguments</span></span>
<span><span class="co">#&gt; [[1]]$arguments[[1]]</span></span>
<span><span class="co">#&gt; [1] "state[0]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$arguments[[2]]</span></span>
<span><span class="co">#&gt; [1] "state[1]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$simulation_phase</span></span>
<span><span class="co">#&gt; [1] "during_pre_update"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$output_names</span></span>
<span><span class="co">#&gt; [1] "N.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$expression</span></span>
<span><span class="co">#&gt; [1] "sum(state[2], state[3])"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$arguments</span></span>
<span><span class="co">#&gt; [[2]]$arguments[[1]]</span></span>
<span><span class="co">#&gt; [1] "state[2]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$arguments[[2]]</span></span>
<span><span class="co">#&gt; [1] "state[3]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$simulation_phase</span></span>
<span><span class="co">#&gt; [1] "during_pre_update"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [[3]]$output_names</span></span>
<span><span class="co">#&gt; [1] "dummy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$expression</span></span>
<span><span class="co">#&gt; [1] "assign(flow, 0, 0, ((((susceptibility.young. * contact.young.young) * infectivity.young.) * state[1]) / N.young.))"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments</span></span>
<span><span class="co">#&gt; [[3]]$arguments[[1]]</span></span>
<span><span class="co">#&gt; [1] "flow"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments[[2]]</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments[[3]]</span></span>
<span><span class="co">#&gt; [1] "susceptibility.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments[[4]]</span></span>
<span><span class="co">#&gt; [1] "contact.young.young"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments[[5]]</span></span>
<span><span class="co">#&gt; [1] "infectivity.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments[[6]]</span></span>
<span><span class="co">#&gt; [1] "state[1]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$arguments[[7]]</span></span>
<span><span class="co">#&gt; [1] "N.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$simulation_phase</span></span>
<span><span class="co">#&gt; [1] "during_pre_update"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [[4]]$output_names</span></span>
<span><span class="co">#&gt; [1] "dummy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$expression</span></span>
<span><span class="co">#&gt; [1] "assign(flow, 2, 0, ((((susceptibility.young. * contact.young.old) * infectivity.old.) * state[3]) / N.young.))"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments</span></span>
<span><span class="co">#&gt; [[4]]$arguments[[1]]</span></span>
<span><span class="co">#&gt; [1] "flow"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments[[2]]</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments[[3]]</span></span>
<span><span class="co">#&gt; [1] "susceptibility.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments[[4]]</span></span>
<span><span class="co">#&gt; [1] "contact.young.old"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments[[5]]</span></span>
<span><span class="co">#&gt; [1] "infectivity.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments[[6]]</span></span>
<span><span class="co">#&gt; [1] "state[3]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$arguments[[7]]</span></span>
<span><span class="co">#&gt; [1] "N.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]$simulation_phase</span></span>
<span><span class="co">#&gt; [1] "during_pre_update"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [[5]]$output_names</span></span>
<span><span class="co">#&gt; [1] "dummy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$expression</span></span>
<span><span class="co">#&gt; [1] "assign(flow, 1, 0, ((((susceptibility.old. * contact.old.young) * infectivity.young.) * state[1]) / N.old.))"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments</span></span>
<span><span class="co">#&gt; [[5]]$arguments[[1]]</span></span>
<span><span class="co">#&gt; [1] "flow"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments[[2]]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments[[3]]</span></span>
<span><span class="co">#&gt; [1] "susceptibility.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments[[4]]</span></span>
<span><span class="co">#&gt; [1] "contact.old.young"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments[[5]]</span></span>
<span><span class="co">#&gt; [1] "infectivity.young."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments[[6]]</span></span>
<span><span class="co">#&gt; [1] "state[1]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$arguments[[7]]</span></span>
<span><span class="co">#&gt; [1] "N.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]$simulation_phase</span></span>
<span><span class="co">#&gt; [1] "during_pre_update"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [[6]]$output_names</span></span>
<span><span class="co">#&gt; [1] "dummy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$expression</span></span>
<span><span class="co">#&gt; [1] "assign(flow, 3, 0, ((((susceptibility.old. * contact.old.old) * infectivity.old.) * state[3]) / N.old.))"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments</span></span>
<span><span class="co">#&gt; [[6]]$arguments[[1]]</span></span>
<span><span class="co">#&gt; [1] "flow"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments[[2]]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments[[3]]</span></span>
<span><span class="co">#&gt; [1] "susceptibility.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments[[4]]</span></span>
<span><span class="co">#&gt; [1] "contact.old.old"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments[[5]]</span></span>
<span><span class="co">#&gt; [1] "infectivity.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments[[6]]</span></span>
<span><span class="co">#&gt; [1] "state[3]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$arguments[[7]]</span></span>
<span><span class="co">#&gt; [1] "N.old."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]$simulation_phase</span></span>
<span><span class="co">#&gt; [1] "during_pre_update"</span></span>
<span><span class="va">prod</span><span class="op">$</span><span class="fu">expr_list</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">print_exprs</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Before the simulation loop (t = 0):</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; 1: per_capita_from ~ c(0, 0, 2, 2, 1, 3)</span></span>
<span><span class="co">#&gt; 2: per_capita_to ~ c(1, 1, 3, 3, 0, 2)</span></span>
<span><span class="co">#&gt; 3: per_capita_flow ~ c(0, 2, 1, 3, 4, 5)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; At every iteration of the simulation loop (t = 1 to T):</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt;  1: N.young. ~ sum(state[0], state[1])</span></span>
<span><span class="co">#&gt;  2: N.old. ~ sum(state[2], state[3])</span></span>
<span><span class="co">#&gt;  3: dummy ~ assign(flow, 0, 0, ((((susceptibility.young. * contact.young.young) * </span></span>
<span><span class="co">#&gt;       infectivity.young.) * state[1])/N.young.))</span></span>
<span><span class="co">#&gt;  4: dummy ~ assign(flow, 2, 0, ((((susceptibility.young. * contact.young.old) * </span></span>
<span><span class="co">#&gt;       infectivity.old.) * state[3])/N.young.))</span></span>
<span><span class="co">#&gt;  5: dummy ~ assign(flow, 1, 0, ((((susceptibility.old. * contact.old.young) * </span></span>
<span><span class="co">#&gt;       infectivity.young.) * state[1])/N.old.))</span></span>
<span><span class="co">#&gt;  6: dummy ~ assign(flow, 3, 0, ((((susceptibility.old. * contact.old.old) * </span></span>
<span><span class="co">#&gt;       infectivity.old.) * state[3])/N.old.))</span></span>
<span><span class="co">#&gt;  7: per_capita ~ (state[per_capita_from] * flow[per_capita_flow])</span></span>
<span><span class="co">#&gt;  8: total_inflow ~ groupSums(per_capita, per_capita_to, state_length)</span></span>
<span><span class="co">#&gt;  9: total_outflow ~ groupSums(per_capita, per_capita_from, state_length)</span></span>
<span><span class="co">#&gt; 10: state ~ ((state - total_outflow) + total_inflow)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Walker, Darren Flynn-Primrose, Weiguang Guan, Ben Bolker, Steve Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
