<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="macpan2">
<title>Development Principles and Patterns • macpan2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Development Principles and Patterns">
<meta property="og:description" content="macpan2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/quickstart.html">Quickstart Guide: specifying and simulating a simple compartmental model</a>
    <a class="dropdown-item" href="../articles/quickstart2.html">Quickstart Guide, part 2: specifying and simulating a structured compartmental model</a>
    <a class="dropdown-item" href="../articles/time_varying_parameters.html">Specifying Time-Varying Parameters</a>
    <a class="dropdown-item" href="../articles/calibration.html">Calibrating Compartmental Models to Data</a>
    <a class="dropdown-item" href="../articles/example_models.html">Example Models</a>
    <a class="dropdown-item" href="../articles/flow_types.html">Flow Types</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Development Principles and Patterns</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/canmod/macpan2/blob/HEAD/vignettes/development_patterns.Rmd" class="external-link"><code>vignettes/development_patterns.Rmd</code></a></small>
      <div class="d-none name"><code>development_patterns.Rmd</code></div>
    </div>

    
    
<p><a href="https://canmod.github.io/macpan2/articles/vignette-status#stub"><img src="https://img.shields.io/badge/status-stub-red" alt="status"></a></p>
<div class="section level2">
<h2 id="principles">Principles<a class="anchor" aria-label="anchor" href="#principles"></a>
</h2>
<p>There will be trade-offs among these principles, but they are good
guidelines.</p>
<div class="section level3">
<h3 id="small-classes">Small Classes<a class="anchor" aria-label="anchor" href="#small-classes"></a>
</h3>
<p>You should be able to see the whole constructor definition on a
single screen – it is OK if it doesn’t happen though.</p>
</div>
<div class="section level3">
<h3 id="avoid-modifying-well-tested-classes">Avoid Modifying Well-Tested Classes<a class="anchor" aria-label="anchor" href="#avoid-modifying-well-tested-classes"></a>
</h3>
<p>Extension is better done by introducing new classes, rather than new
methods. Big classes are hard to reason about, test, and stabilize.</p>
</div>
<div class="section level3">
<h3 id="linear-inheritance">Linear Inheritance<a class="anchor" aria-label="anchor" href="#linear-inheritance"></a>
</h3>
<p>Classes should not inherit from multiple parents.</p>
</div>
<div class="section level3">
<h3 id="shallow-inheritance-hierarchy">Shallow Inheritance Hierarchy<a class="anchor" aria-label="anchor" href="#shallow-inheritance-hierarchy"></a>
</h3>
<p>Parent classes may have multiple children, but in these cases the
hierarchy should be shallow and simple. For example, consider
alternatives if some children inherit directly from an intermediate
parent. When things like this start to happen, it is usually best to
just extend the intermediate parent so that it can inherit directly from
the <code>Base</code> class.</p>
</div>
<div class="section level3">
<h3 id="balance-regeneration-with-consistency">Balance Regeneration with Consistency<a class="anchor" aria-label="anchor" href="#balance-regeneration-with-consistency"></a>
</h3>
<p>A naive approach to keeping the components of objects consistent is
to regenerate the object with every change. But continual regeneration
can be expensive. It is best to avoid this trade-off as much as possible
by making fields that are cheap to compute into methods that always
recompute what the user is asking for. But some fields are too expensive
to regenerate and therefore need to be stored and only regenerated when
necessary.</p>
</div>
</div>
<div class="section level2">
<h2 id="patterns">Patterns<a class="anchor" aria-label="anchor" href="#patterns"></a>
</h2>
<p>Here are some design patterns for complying with these
principles.</p>
<div class="section level3">
<h3 id="alternative-classes">Alternative Classes<a class="anchor" aria-label="anchor" href="#alternative-classes"></a>
</h3>
<p>Alterative versions of a class have the same set of methods as the
initial version. It needs change then it becomes easy to swap out one
alterative for another. For example, the <code><a href="../reference/Reader.html">Reader()</a></code> classes
all have a single method – <code>$read()</code> – without arguments.
Therefore, any bit of functionality that requires data to be read in can
be modified simply by writing a new reader and swapping it in for the
old one, without needing to modify any of the code that calls the
<code>$read()</code> method. The methods in alternative classes should
return the same type of object, but obviously the return value itself
can and should vary.</p>
</div>
<div class="section level3">
<h3 id="types-of-object-components">Types of Object Components<a class="anchor" aria-label="anchor" href="#types-of-object-components"></a>
</h3>
<p>There should only be the following types of object components.</p>
<ol style="list-style-type: decimal">
<li>Standard methods – Methods computing and returning values derived
from arguments to the constructor</li>
<li>Composition – Objects with further fields and methods</li>
<li>Args – Fields storing arguments to the constructor</li>
<li>Static – Fields storing values derived from arguments to the
constructor</li>
<li>A <code>$refesh()</code> method that can be called to update #3
components in-place</li>
<li>Private methods – Methods that should only be called by other
methods in the class</li>
</ol>
<p>How to decide what kind of component to use for each piece of
information will depend on the following considerations.</p>
<p>Standard methods should only be used if they are cheap to run, so
that regeneration and consistency are balanced. But this pattern is
generally the preferred option, because it is simplest to reason about
and maintain because it more directly ensures consistency.</p>
<p>Composition of objects and classes looks like this.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">b</span> <span class="op">=</span> <span class="fu">B</span><span class="op">(</span><span class="va">self</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span>
<span><span class="va">...</span></span>
<span><span class="va">B</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">a</span> <span class="op">=</span> <span class="va">a</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then other developers and users can do the following.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">=</span> <span class="fu">A</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">b</span><span class="op">$</span><span class="fu">method</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>This keeps classes small because <code>B</code> can have methods
instead of <code>A</code>, and small classes are easier to test and
stabilize. Testing of <code>A</code> can focus on the methods directly
in <code>A</code>, and then <code>A</code> can be extended by composing
new classes like <code>B</code>.</p>
<p>Static fields should be used if they are expensive to compute.
Consistency can be managed by producing static fields in a
<code>$refresh()</code> method – this is a good way to balance
regeneration with consistency. This way, developers of other classes
that are composed components can make use of the <code>$refresh()</code>
method to reliably keep everything up-to-date and consistent. In this
way static fields and <code>$refresh()</code> methods work together to
balance the cost of regeneration with the necessity of consistency.</p>
<p>In the constructor, this <code>$refresh()</code> pattern looks like
this.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">refresh</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">expensive_field_1</span> <span class="op">=</span> <span class="fu">f_1</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">...</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">expensive_field_n</span> <span class="op">=</span> <span class="fu">f_n</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="fu">refresh</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">b</span> <span class="op">=</span> <span class="fu">B</span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">...</span></span>
<span><span class="va">B</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">a</span> <span class="op">=</span> <span class="va">a</span>  <span class="co">## an instance of `A`</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">method_to_modify_a</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span><span class="va">...</span><span class="op">}</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">a</span><span class="op">$</span><span class="fu">refresh</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Private methods should only be used by other methods in the class.
There is nothing stoping a developer or a user from calling a private
method, but there is no guarantee that the private method with have
consistent behaviour or even exist. To communicate privacy, private
methods should start with a dot as the following example shows.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">.private</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span><span class="va">...</span><span class="op">}</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">self</span><span class="op">$</span><span class="va">public</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">...</span></span>
<span>    <span class="fu">self.private</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Walker, Darren Flynn-Primrose, Weiguang Guan, Ben Bolker, Steve Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
