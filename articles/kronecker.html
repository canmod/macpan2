<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Structured SI Model with Kronecker Products in macpan2 â€¢ macpan2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Structured SI Model with Kronecker Products in macpan2">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/example_models.html">Example Models</a></li>
    <li><a class="dropdown-item" href="../articles/calibration.html">Calibrating Compartmental Models to Data</a></li>
    <li><a class="dropdown-item" href="../articles/real_data.html">Fitting to Real Data</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">Options</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Structured SI Model with Kronecker Products in macpan2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/canmod/macpan2/blob/main/vignettes/kronecker.Rmd" class="external-link"><code>vignettes/kronecker.Rmd</code></a></small>
      <div class="d-none name"><code>kronecker.Rmd</code></div>
    </div>

    
    
<p><a href="https://canmod.github.io/macpan2/articles/vignette-status#mature-draft"><img src="https://img.shields.io/badge/status-mature%20draft-yellow" alt="status"></a></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document illustrates how to implement structured compartmental
models in <code>macpan2</code> using Kronecker products to define state
vectors, parameter matrices, and flows over stratified dimensions. As an
example, we stratify an SI model along the following dimensions: age
group, vaccination status, and symptom severity.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_dimensions</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"vax"</span>, <span class="st">"symp"</span><span class="op">)</span></span>
<span><span class="va">age</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"young"</span>, <span class="st">"old"</span><span class="op">)</span></span>
<span><span class="va">vax</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"unvax"</span>, <span class="st">"vax"</span><span class="op">)</span></span>
<span><span class="va">symp</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"mild"</span>, <span class="st">"severe"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="utilities-and-packages">Utilities and Packages<a class="anchor" aria-label="anchor" href="#utilities-and-packages"></a>
</h2>
<p>We load the necessary packages and define some utility functions that
simplify the construction of named vectors and matrices over these
stratification dimensions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://canmod.github.io/macpan2/">macpan2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<p>We overwrite the base <code>R</code> Kronecker product operator,
<code>%x%</code>, to consistently preserve row and column names. This
operator will be used often when defining model structure. It returns
the same numerical results as base <code>R</code>, but with consistently
named rows and columns.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">`%x%`</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mp_kronecker_operator.html">mp_kronecker_operator</a></span><span class="op">(</span><span class="va">`*`</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ones_vec()</code> utility creates a named vector of ones
over the cross-product of the input character vectors (strata). It uses
Kronecker products to ensure the names follow the same ordering
convention as Kronecker-structured vectors and matrices elsewhere in the
model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ones_vec</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">vecs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nms</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="../reference/engine_functions.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">`%x%`</span>, <span class="va">vecs</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code>diagonal()</code> utility is much like the base-R
<code><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag()</a></code> function, but takes its row and column names from
the names of the input vector.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagonal</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"can only produce a square diagonal matrix for a vector"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">nms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">nms</span>, <span class="va">nms</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity()</a></code> function takes character vectors and
returns an identity matrix over their Cartesian product. It uses
<code>ones_vec()</code> and <code>diagonal()</code> to define the
dimension names and place ones on the diagonal.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">identity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">ones_vec</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">diagonal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ones_col()</code> (<code>ones_row()</code>) function takes
character vectors and returns a column (row) vector of ones, with row
(column) names based on the Cartesian product of the input strata.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ones_col</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">ones_vec</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/engine_functions.html">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/engine_functions.html">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ones_row</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">ones_col</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/engine_functions.html">t</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here are a few examples.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">vax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             young.unvax young.vax old.unvax old.vax</span></span>
<span><span class="co">## young.unvax           1         0         0       0</span></span>
<span><span class="co">## young.vax             0         1         0       0</span></span>
<span><span class="co">## old.unvax             0         0         1       0</span></span>
<span><span class="co">## old.vax               0         0         0       1</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ones_col</span><span class="op">(</span><span class="va">age</span>, <span class="va">vax</span>, <span class="va">symp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                    [,1]</span></span>
<span><span class="co">## young.unvax.mild      1</span></span>
<span><span class="co">## young.unvax.severe    1</span></span>
<span><span class="co">## young.vax.mild        1</span></span>
<span><span class="co">## young.vax.severe      1</span></span>
<span><span class="co">## old.unvax.mild        1</span></span>
<span><span class="co">## old.unvax.severe      1</span></span>
<span><span class="co">## old.vax.mild          1</span></span>
<span><span class="co">## old.vax.severe        1</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ones_row</span><span class="op">(</span><span class="va">vax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      unvax vax</span></span>
<span><span class="co">## [1,]     1   1</span></span></code></pre>
<p>The <code>ones_col()</code>, <code>ones_row()</code>, and
<code><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity()</a></code> functions make it easier to build vectors and
matrices that align with stratified model dimensions, enabling clear and
consistent operations like summing over strata or selecting specific
blocks.</p>
</div>
<div class="section level2">
<h2 id="initial-state-vectors">Initial State Vectors<a class="anchor" aria-label="anchor" href="#initial-state-vectors"></a>
</h2>
<p>We now use Kronecker products to initialize the state vectors
<code>S</code> (susceptible) and <code>I</code> (infectious) over the
stratification dimensions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">75</span>, old <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>unvax <span class="op">=</span> <span class="fl">1</span>, vax <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">I</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">1</span>, old <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>unvax <span class="op">=</span> <span class="fl">1</span>, vax <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>mild <span class="op">=</span> <span class="fl">1</span>, severe <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## young.unvax   young.vax   old.unvax     old.vax </span></span>
<span><span class="co">##          75           0          25           0</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   young.unvax.mild young.unvax.severe     young.vax.mild   young.vax.severe </span></span>
<span><span class="co">##                  1                  0                  0                  0 </span></span>
<span><span class="co">##     old.unvax.mild   old.unvax.severe       old.vax.mild     old.vax.severe </span></span>
<span><span class="co">##                  0                  0                  0                  0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-parameters">Model Parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h2>
<p>We define default values for the following parameters:</p>
<ul>
<li>Baseline transmission</li>
<li>Vaccination rates</li>
<li>Vaccine efficacy</li>
<li>Contact matrix</li>
<li>Symptom severity probabilities</li>
<li>Multiplicative effects of stratification on susceptibility and
infectivity.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="va">contact_matrix</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">rbind</a></span><span class="op">(</span></span>
<span>  young <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">0.8</span>, old <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  old   <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">0.2</span>, old <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">symp_probs</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">rbind</a></span><span class="op">(</span>mild <span class="op">=</span> <span class="fl">0.6</span>, severe <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">susceptibility_age</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">rbind</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">0.9</span>, old <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">infectivity_age</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">cbind</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">1</span>, old <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="va">infectivity_vax</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">cbind</a></span><span class="op">(</span>unvax <span class="op">=</span> <span class="fl">1</span>, vax <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">infectivity_symp</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">cbind</a></span><span class="op">(</span>mild <span class="op">=</span> <span class="fl">0.95</span>, severe <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">vax_rates</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">rbind</a></span><span class="op">(</span>young <span class="op">=</span> <span class="fl">0.1</span>, old <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">VE</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">rbind</a></span><span class="op">(</span>unvax <span class="op">=</span> <span class="fl">0</span>, vax <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p>Note that instead of <code>c</code> for constructing vectors, we use
<code>rbind</code> (for column vectors) and <code>cbind</code> (for row
vectors). It is good practice to be explicit about the orientation of
vectors when Kronecker products are involved.</p>
</div>
<div class="section level2">
<h2 id="derived-state-vectors">Derived State Vectors<a class="anchor" aria-label="anchor" href="#derived-state-vectors"></a>
</h2>
<p>To define flows and compute quantities like force of infection or
vaccination rates, we often need to aggregate or restrict the original
state vectors by strata. Derived state vectors let us isolate relevant
subpopulations or repeat totals to match dimensional structure in
downstream operations.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M_unvax</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu"><a href="../reference/engine_functions.html">cbind</a></span><span class="op">(</span>unvax <span class="op">=</span> <span class="fl">1</span>, vax <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">M_S</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu">ones_row</span><span class="op">(</span><span class="va">vax</span><span class="op">)</span></span>
<span><span class="va">M_I</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu">ones_row</span><span class="op">(</span><span class="va">vax</span>, <span class="va">symp</span><span class="op">)</span></span>
<span><span class="va">M_N</span> <span class="op">=</span> <span class="fu">ones_col</span><span class="op">(</span><span class="va">vax</span>, <span class="va">symp</span><span class="op">)</span></span>
<span><span class="va">S_unvax</span> <span class="op">=</span> <span class="va">M_unvax</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">S</span></span>
<span><span class="va">N_age</span> <span class="op">=</span> <span class="op">(</span><span class="va">M_S</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">S</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">M_I</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">I</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">=</span> <span class="va">N_age</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">M_N</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">S_unvax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1]</span></span>
<span><span class="co">## young   75</span></span>
<span><span class="co">## old     25</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">N_age</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1]</span></span>
<span><span class="co">## young   76</span></span>
<span><span class="co">## old     25</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   young.unvax.mild young.unvax.severe     young.vax.mild   young.vax.severe </span></span>
<span><span class="co">##                 76                 76                 76                 76 </span></span>
<span><span class="co">##     old.unvax.mild   old.unvax.severe       old.vax.mild     old.vax.severe </span></span>
<span><span class="co">##                 25                 25                 25                 25</span></span></code></pre>
<p>Note that <code>N</code> repeats the total population size within
each age group to match the structure of the force of infection.
<code>S_unvax</code> isolates the unvaccinated susceptible compartments,
which are the only ones eligible for vaccination flows.</p>
</div>
<div class="section level2">
<h2 id="per-capita-transmission-matrix">Per-Capita Transmission Matrix<a class="anchor" aria-label="anchor" href="#per-capita-transmission-matrix"></a>
</h2>
<p>We construct the full per-capita transmission matrix by combining
component matrices using Kronecker products and elementwise
multiplication.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B_age</span> <span class="op">=</span> <span class="op">(</span></span>
<span>    <span class="va">beta</span> </span>
<span>  <span class="op">*</span> <span class="va">contact_matrix</span> </span>
<span>  <span class="op">*</span> <span class="op">(</span><span class="va">susceptibility_age</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">infectivity_age</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">B_vax</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">VE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">infectivity_vax</span></span>
<span><span class="va">B_symp</span> <span class="op">=</span> <span class="va">infectivity_symp</span></span>
<span><span class="va">B</span> <span class="op">=</span> <span class="va">B_age</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">B_vax</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">B_symp</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">B_age</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       young    old</span></span>
<span><span class="co">## young 0.288 0.0648</span></span>
<span><span class="co">## old   0.080 0.2880</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">B_vax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       unvax  vax</span></span>
<span><span class="co">## unvax   1.0 0.80</span></span>
<span><span class="co">## vax     0.2 0.16</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">B_symp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      mild severe</span></span>
<span><span class="co">## [1,] 0.95      1</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             young.unvax.mild young.unvax.severe young.vax.mild young.vax.severe</span></span>
<span><span class="co">## young.unvax          0.27360             0.2880       0.218880          0.23040</span></span>
<span><span class="co">## young.vax            0.05472             0.0576       0.043776          0.04608</span></span>
<span><span class="co">## old.unvax            0.07600             0.0800       0.060800          0.06400</span></span>
<span><span class="co">## old.vax              0.01520             0.0160       0.012160          0.01280</span></span>
<span><span class="co">##             old.unvax.mild old.unvax.severe old.vax.mild old.vax.severe</span></span>
<span><span class="co">## young.unvax       0.061560          0.06480    0.0492480       0.051840</span></span>
<span><span class="co">## young.vax         0.012312          0.01296    0.0098496       0.010368</span></span>
<span><span class="co">## old.unvax         0.273600          0.28800    0.2188800       0.230400</span></span>
<span><span class="co">## old.vax           0.054720          0.05760    0.0437760       0.046080</span></span></code></pre>
<p>The per-capita transmission matrix maps infectious compartments to
susceptible compartments and determines the force of infection
associated with each susceptible stratum. The row names give the
susceptible strata, and the column names the infectious strata.</p>
</div>
<div class="section level2">
<h2 id="per-capita-force-of-infection">Per-Capita Force of Infection<a class="anchor" aria-label="anchor" href="#per-capita-force-of-infection"></a>
</h2>
<p>The force of infection is computed by multiplying the per-capita
transmission matrix by the normalized infectious population.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">foi</span> <span class="op">=</span> <span class="va">B</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">I</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">foi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                [,1]</span></span>
<span><span class="co">## young.unvax 0.00360</span></span>
<span><span class="co">## young.vax   0.00072</span></span>
<span><span class="co">## old.unvax   0.00100</span></span>
<span><span class="co">## old.vax     0.00020</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="absolute-flows">Absolute Flows<a class="anchor" aria-label="anchor" href="#absolute-flows"></a>
</h2>
<p>We compute total flows due to infection and vaccination by
multiplying per-capita rates by the relevant state vectors.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span> <span class="op">=</span> <span class="va">foi</span> <span class="op">*</span> <span class="va">S</span></span>
<span><span class="va">vaccination</span> <span class="op">=</span> <span class="va">vax_rates</span> <span class="op">*</span> <span class="va">S_unvax</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">infection</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              [,1]</span></span>
<span><span class="co">## young.unvax 0.270</span></span>
<span><span class="co">## young.vax   0.000</span></span>
<span><span class="co">## old.unvax   0.025</span></span>
<span><span class="co">## old.vax     0.000</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">vaccination</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1]</span></span>
<span><span class="co">## young  7.5</span></span>
<span><span class="co">## old   10.0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="allocation-matrices">Allocation Matrices<a class="anchor" aria-label="anchor" href="#allocation-matrices"></a>
</h2>
<p>In structured models, flows often act on families of compartments
rather than individual compartments. This can obscure which specific
sub-compartments are gaining or losing individuals. Allocation matrices
resolve this by mapping flow vectors into change vectors that align with
the structure of state vectors.</p>
<p>They allow us to:</p>
<ul>
<li>Distribute outflows from a compartment to multiple destination
compartments (e.g., infections split by symptom severity).</li>
<li>Apply signed changes within a state vector (e.g., moving individuals
from unvaccinated to vaccinated compartments within the susceptible
state vector).</li>
</ul>
<p>This ensures that each flow is properly aligned with the compartments
it affects.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A_infection</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">vax</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">symp_probs</span></span>
<span><span class="va">A_vaccination</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu"><a href="../reference/engine_functions.html">rbind</a></span><span class="op">(</span>unvax <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, vax <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">infection_S</span> <span class="op">=</span> <span class="va">infection</span></span>
<span><span class="va">infection_I</span> <span class="op">=</span> <span class="va">A_infection</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">infection</span></span>
<span><span class="va">vaccination_S</span> <span class="op">=</span> <span class="va">A_vaccination</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">vaccination</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">infection_S</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              [,1]</span></span>
<span><span class="co">## young.unvax 0.270</span></span>
<span><span class="co">## young.vax   0.000</span></span>
<span><span class="co">## old.unvax   0.025</span></span>
<span><span class="co">## old.vax     0.000</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">infection_I</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     [,1]</span></span>
<span><span class="co">## young.unvax.mild   0.162</span></span>
<span><span class="co">## young.unvax.severe 0.108</span></span>
<span><span class="co">## young.vax.mild     0.000</span></span>
<span><span class="co">## young.vax.severe   0.000</span></span>
<span><span class="co">## old.unvax.mild     0.015</span></span>
<span><span class="co">## old.unvax.severe   0.010</span></span>
<span><span class="co">## old.vax.mild       0.000</span></span>
<span><span class="co">## old.vax.severe     0.000</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">vaccination_S</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              [,1]</span></span>
<span><span class="co">## young.unvax  -7.5</span></span>
<span><span class="co">## young.vax     7.5</span></span>
<span><span class="co">## old.unvax   -10.0</span></span>
<span><span class="co">## old.vax      10.0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="euler-step-update">Euler Step Update<a class="anchor" aria-label="anchor" href="#euler-step-update"></a>
</h2>
<p>Using the change vectors produced using products of allocation
matrices and state vectors, we update the original state vectors with a
forward Euler step.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S_new</span> <span class="op">=</span> <span class="va">S</span> <span class="op">-</span> <span class="va">infection_S</span> <span class="op">+</span> <span class="va">vaccination_S</span></span>
<span><span class="va">I_new</span> <span class="op">=</span> <span class="va">I</span> <span class="op">+</span> <span class="va">infection_I</span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">S_new</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               [,1]</span></span>
<span><span class="co">## young.unvax 67.230</span></span>
<span><span class="co">## young.vax    7.500</span></span>
<span><span class="co">## old.unvax   14.975</span></span>
<span><span class="co">## old.vax     10.000</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">I_new</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     [,1]</span></span>
<span><span class="co">## young.unvax.mild   1.162</span></span>
<span><span class="co">## young.unvax.severe 0.108</span></span>
<span><span class="co">## young.vax.mild     0.000</span></span>
<span><span class="co">## young.vax.severe   0.000</span></span>
<span><span class="co">## old.unvax.mild     0.015</span></span>
<span><span class="co">## old.unvax.severe   0.010</span></span>
<span><span class="co">## old.vax.mild       0.000</span></span>
<span><span class="co">## old.vax.severe     0.000</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>We formalize the model specification with
<code>mp_tmb_model_spec</code>, defining the derived quantities, flows,
and update rules.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">=</span> <span class="fu"><a href="../reference/mp_tmb_model_spec.html">mp_tmb_model_spec</a></span><span class="op">(</span></span>
<span>  before <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="va">B_age</span> <span class="op">~</span> <span class="op">(</span></span>
<span>          <span class="va">beta</span> </span>
<span>        <span class="op">*</span> <span class="va">contact_matrix</span> </span>
<span>        <span class="op">*</span> <span class="op">(</span><span class="va">susceptibility_age</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">infectivity_age</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    , <span class="va">B_vax</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">VE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">infectivity_vax</span></span>
<span>    , <span class="va">B_symp</span> <span class="op">~</span> <span class="va">infectivity_symp</span></span>
<span>    , <span class="va">B</span> <span class="op">~</span> <span class="va">B_age</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">B_vax</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">B_symp</span></span>
<span></span>
<span>  <span class="op">)</span>,</span>
<span>  during <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># derived state vectors</span></span>
<span>      <span class="va">N_age</span> <span class="op">~</span> <span class="op">(</span><span class="va">M_S</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">S</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">M_I</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">I</span><span class="op">)</span></span>
<span>    , <span class="va">N</span> <span class="op">~</span> <span class="va">N_age</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="va">M_N</span></span>
<span>    , <span class="va">S_unvax</span> <span class="op">~</span> <span class="va">M_unvax</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">S</span></span>
<span>    </span>
<span>    <span class="co"># state-dependent per-capita rates</span></span>
<span>    , <span class="va">foi</span> <span class="op">~</span> <span class="va">B</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">I</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># absolute flow vectors</span></span>
<span>    , <span class="va">infection</span> <span class="op">~</span> <span class="va">foi</span> <span class="op">*</span> <span class="va">S</span></span>
<span>    , <span class="va">vaccination</span> <span class="op">~</span> <span class="va">vax_rates</span> <span class="op">*</span> <span class="va">S_unvax</span></span>
<span>    </span>
<span>    <span class="co"># absolute change vectors</span></span>
<span>    , <span class="va">infection_S</span> <span class="op">~</span> <span class="op">-</span><span class="va">infection</span></span>
<span>    , <span class="va">infection_I</span> <span class="op">~</span> <span class="va">A_infection</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">infection</span></span>
<span>    , <span class="va">vaccination_S</span> <span class="op">~</span> <span class="va">A_vaccination</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">vaccination</span></span>
<span>    </span>
<span>    <span class="co"># state update (euler step)</span></span>
<span>    , <span class="va">S</span> <span class="op">~</span> <span class="va">S</span> <span class="op">+</span> <span class="va">infection_S</span> <span class="op">+</span> <span class="va">vaccination_S</span></span>
<span>    , <span class="va">I</span> <span class="op">~</span> <span class="va">I</span> <span class="op">+</span> <span class="va">infection_I</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># initial state vectors</span></span>
<span>  inits <span class="op">=</span> <span class="fu"><a href="../reference/nlist.html">nlist</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">I</span><span class="op">)</span>,</span>
<span>  </span>
<span>  default <span class="op">=</span> <span class="fu"><a href="../reference/nlist.html">nlist</a></span><span class="op">(</span></span>
<span>    <span class="co"># parameter scalars</span></span>
<span>      <span class="va">beta</span></span>
<span>  </span>
<span>    <span class="co"># parameter vectors</span></span>
<span>    , <span class="va">vax_rates</span>, <span class="va">VE</span></span>
<span>    , <span class="va">susceptibility_age</span></span>
<span>    , <span class="va">infectivity_age</span>, <span class="va">infectivity_vax</span>, <span class="va">infectivity_symp</span></span>
<span>    </span>
<span>    <span class="co"># parameter matrices</span></span>
<span>    , <span class="va">contact_matrix</span></span>
<span>    </span>
<span>    <span class="co"># state vector transformation matrices</span></span>
<span>    , <span class="va">M_S</span>, <span class="va">M_I</span>, <span class="va">M_N</span>, <span class="va">M_unvax</span></span>
<span>    </span>
<span>    <span class="co"># allocation matrices</span></span>
<span>    , <span class="va">A_infection</span>, <span class="va">A_vaccination</span></span>
<span>    </span>
<span>    <span class="co"># absolute flow and change vectors</span></span>
<span>    <span class="co">#   - included here so that row names can be used </span></span>
<span>    <span class="co">#     in simulated trajectories</span></span>
<span>    <span class="co">#   - if removed from this list, the simulations</span></span>
<span>    <span class="co">#     will use generic integer IDs for each </span></span>
<span>    <span class="co">#     stratum</span></span>
<span>    , <span class="va">infection</span>, <span class="va">vaccination</span></span>
<span>    , <span class="va">infection_S</span>, <span class="va">infection_I</span>, <span class="va">vaccination_S</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-and-plots">Simulation and Plots<a class="anchor" aria-label="anchor" href="#simulation-and-plots"></a>
</h2>
<p>We simulate the model over time and visualize the resulting
trajectories of the state vectors and flow rates by stratification. The
first step is to generate the simulations.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## state vectors</span></span>
<span><span class="va">state</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## absolute flow rates</span></span>
<span><span class="va">flow</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"infection"</span>, <span class="st">"vaccination"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># absolute change vectors</span></span>
<span><span class="va">change</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"infection_S"</span>, <span class="st">"infection_I"</span>, <span class="st">"vaccination_S"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">traj</span> <span class="op">=</span> <span class="op">(</span><span class="va">spec</span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_simulator.html">mp_simulator</a></span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">100</span>, outputs <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">flow</span>, <span class="va">change</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_trajectory.html">mp_trajectory</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">## separate row names into </span></span>
<span>  <span class="co">## names for each stratum</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">row</span></span>
<span>      , delim <span class="op">=</span> <span class="st">"."</span></span>
<span>      , names <span class="op">=</span> <span class="va">model_dimensions</span></span>
<span>      , too_few <span class="op">=</span> <span class="st">"align_start"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## make stratum names easier to read</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vax <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">vax</span> <span class="op">==</span> <span class="st">"unvax"</span> <span class="op">~</span> <span class="st">"Unvaccinated"</span></span>
<span>      , <span class="va">vax</span> <span class="op">==</span> <span class="st">"vax"</span> <span class="op">~</span> <span class="st">"Vaccinated"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_title</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="../reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">traj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3,400 Ã— 7</span></span></span>
<span><span class="co">##    matrix       time age   vax          symp  col    value</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> infection       1 Young Unvaccinated <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     0.27 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> infection       1 Young Vaccinated   <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     0    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> infection       1 Old   Unvaccinated <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     0.025</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> infection       1 Old   Vaccinated   <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     0    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> vaccination     1 Young <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     7.5  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> vaccination     1 Old   <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>    10    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> infection_S     1 Young Unvaccinated <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>    -<span style="color: #BB0000;">0.27</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> infection_S     1 Young Vaccinated   <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     0    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> infection_S     1 Old   Unvaccinated <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>    -<span style="color: #BB0000;">0.025</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> infection_S     1 Old   Vaccinated   <span style="color: #BB0000;">NA</span>    <span style="color: #949494;">""</span>     0    </span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 3,390 more rows</span></span></span></code></pre>
<p>Here is a plot of the state vector trajectories.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">traj</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">state</span><span class="op">)</span> </span>
<span> </span>
<span>  <span class="co">## make names easier to read</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">matrix</span> <span class="op">==</span> <span class="st">"S"</span> <span class="op">~</span> <span class="st">"Susceptible"</span></span>
<span>      , <span class="va">matrix</span> <span class="op">==</span> <span class="st">"I"</span> <span class="op">~</span> <span class="st">"Infectious"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>        <span class="va">state</span> <span class="op">==</span> <span class="st">"Infectious"</span></span>
<span>      , <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s\n(%s)"</span>, <span class="va">state</span>, <span class="va">symp</span><span class="op">)</span></span>
<span>      , <span class="va">state</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## plot</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">vax</span>, space <span class="op">=</span> <span class="st">'free'</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="kronecker_files/figure-html/simulation-plot-1.png" width="576"></p>
<p>Structured SI models have the potential to become more interesting
relative to the unstructured version. For a simple example in the above
plot, two susceptible compartments display intermediate peaks that
reflect a balance between vaccination and infection processes. In
contrast, the susceptible compartment in the unstructured SI model can
only decrease over time. You could produce this plot for different
values of <a href="#model-parameters">the parameters</a> (e.g., vaccine
efficacy) to explore how these differences affect dynamics.</p>
<p>We can make a similar plot of the absolute rates of flow (per time
step) among compartments. These flow rates are stored in the
<code>infection</code> and <code>vaccination</code> vectors.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">traj</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">flow</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_title</a></span><span class="op">(</span><span class="va">matrix</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flow <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>        <span class="va">matrix</span> <span class="op">==</span> <span class="st">"Infection"</span></span>
<span>      , <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s\n(%s)"</span>, <span class="va">matrix</span>, <span class="va">vax</span><span class="op">)</span></span>
<span>      , <span class="va">matrix</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">flow</span> <span class="op">~</span> <span class="va">age</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="kronecker_files/figure-html/simulation-plot-incidence-1.png" width="480"></p>
<p>In structured models, absolute flow rates translate into
process-specific rates of change of state variables in a more complex
way than in unstructured models. One example of this added complexity is
that flows alone do not determine how individuals are distributed across
symptom status compartments. To address this, allocation matrices â€“
<code>A_infection</code> and <code>A_vaccination</code> â€“ are used to
map each process-specific flow onto the appropriate rate of change in
the state variables. These matrices define how the flows are distributed
across strata, such as symptom status. The plot below illustrates the
resulting changes in the state vector.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">traj</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">change</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">matrix</span></span>
<span>      , delim <span class="op">=</span> <span class="st">"_"</span></span>
<span>      , names <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"flow"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">state</span> <span class="op">==</span> <span class="st">"S"</span> <span class="op">~</span> <span class="st">"Susceptible"</span></span>
<span>      , <span class="va">state</span> <span class="op">==</span> <span class="st">"I"</span> <span class="op">~</span> <span class="st">"Infectious"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>        <span class="va">state</span> <span class="op">==</span> <span class="st">"Infectious"</span></span>
<span>      , <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s\n(%s)"</span>, <span class="va">state</span>, <span class="va">symp</span><span class="op">)</span></span>
<span>      , <span class="va">state</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Change due to\n%s"</span>, <span class="va">flow</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">vax</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">flow</span> <span class="op">+</span> <span class="va">state</span> <span class="op">~</span> <span class="va">age</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"bottom"</span>, title <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="kronecker_files/figure-html/simulation-plot-change-1.png" width="480"></p>
<p>This plot reveals how susceptible individuals are allocated across
symptom status compartments. By using color to represent vaccination
statusâ€”instead of faceting into separate panelsâ€”it simultaneously
highlights differences in rates of change across vaccination groups.</p>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>One cannot use <a href="https://canmod.github.io/macpan2/reference/state_updates">alternate
state update methods</a> with structured models, although this is <a href="https://github.com/canmod/macpan2/issues/288" class="external-link">on the
roadmap</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Walker, Weiguang Guan, Jen Freeman, Ben Bolker, Darren Flynn-Primrose.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
