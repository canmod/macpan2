<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Design Concepts • macpan2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design Concepts">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/example_models.html">Example Models</a></li>
    <li><a class="dropdown-item" href="../articles/calibration.html">Calibrating Compartmental Models to Data</a></li>
    <li><a class="dropdown-item" href="../articles/real_data.html">Fitting to Real Data</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">Options</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Design Concepts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/canmod/macpan2/blob/main/vignettes/design_concepts.Rmd" class="external-link"><code>vignettes/design_concepts.Rmd</code></a></small>
      <div class="d-none name"><code>design_concepts.Rmd</code></div>
    </div>

    
    
<p><a href="https://canmod.github.io/macpan2/articles/vignette-status#working-draft"><img src="https://img.shields.io/badge/status-working%20draft-red" alt="status"></a></p>
<p><img src="../reference/figures//design-concepts.svg"><!-- --></p>
<div class="section level3">
<h3 id="information-processing">Information Processing<a class="anchor" aria-label="anchor" href="#information-processing"></a>
</h3>
<p>Like other statistical modelling software, the high-level purpose of
<code>macpan2</code> is to process data sources (top-left) into results
(bottom-left). In the case of <code>macpan2</code>, this processing is
done using compartmental modelling (right). The major steps of
information processing are numbered in the diagram, and we describe each
of these.</p>
<ol style="list-style-type: decimal">
<li>Information processing begins with accessing and preparing numerical
information from various data sources, with the output being standard
numerical R objects. Depending on the nature of the analysis to follow,
this information could include default values for parameters
(e.g. transmission rate), initial values for the state variables
(e.g. initial number of infectious individuals), operational schedules
(e.g. timing of lockdown events or vaccine roll-out schedules), and data
for model fitting (e.g. time series of hospital utilization). This step
could involve connecting to real-time surveillance platforms or reading
in static data files. There is not any functionality within
<code>macpan2</code> for conducting this step – <a href="#modularity"><code>macpan2</code> does not try to reinvent the
wheel in data access and preparation</a>.</li>
<li>The structure of a compartmental model is defined in one of three
ways. In all cases the output is ultimately a <a href="#model-simulator">model simulator</a>.
<ul>
<li>(2a) A model is chosen from a model library and read into
<code>R</code>, optionally updating the model structure using an <a href="#engine-agnostic-model-specification-language">engine-agnostic
model specification language</a>.</li>
<li>(2b) A model is written from scratch using the <a href="#engine-agnostic-model-specification-language">engine-agnostic
model specification language</a>.</li>
<li>(2c) A model is written from scratch using one of the <a href="#engine-specific-model-specification-languages">engine-specific
model specification languages</a>. These three are alternatives, in that
if 2a is chosen then 2b and 2c are automatically executed and if 2b is
chosen that 2c is automatic. The choice here is just how close (2c) or
far (2a) from the actual computation engine do you want to be when
specifying models. There are several <a href="#engine-agnostic-versus-engine-specific">considerations when
choosing a model specification workflow</a> when deciding which
alternative to use. No matter which of these approaches is taken, the
output of step 2 is a model simulator that can be used to generate
modelling outputs like simulated incidence time-series or reproduction
numbers.</li>
</ul>
</li>
<li>Although model simulators come with default initial values so that
they can be used immediately, typically one would like to modify these
values without needing to edit the model specifications from step 2.
There are two main use-cases involving such numerical modifications to
the model simulators: In order to formally calibrate model parameters by
fitting the model to observed time-series data and/or modifying default
parameter values to reflect a what-if scenario. In both use-cases, a
model simulator is used as input and another model simulator is produced
as output.</li>
<li>Once the model defining and numerical initialization steps have been
completed, model outputs are produced in long-format data frames.</li>
<li>Finally these model outputs are incorporated into forecasts, plots,
reports, and diagnostics using standard tools outside of
<code>macpan2</code>.</li>
</ol>
</div>
<div class="section level3">
<h3 id="modularity">Modularity<a class="anchor" aria-label="anchor" href="#modularity"></a>
</h3>
<p>Modularity is a key principle of <code>macpan2</code> design in a few
ways.</p>
<p>First, <code>macpan2</code> is meant to plug into standard R
workflows for data pre-processing and simulation post-processing. There
is very little functionality in <code>macpan2</code> for configuring how
data are prepared as input and modelling outputs are processed. Instead,
<code>macpan2</code> accepts standard data objects (data frames,
matrices, vectors) and returns simulations as long-format data frames
that can be processed using standard tools like <code>dplyr</code> and
<code>ggplot2</code>. This design principle is illustrated in the
architecture diagram above that has blue steps representing standard
non-<code>macpan2</code> workflows and red steps representing workflows
that depend on <code>macpan2</code> data structures and objects. The
challenges of building the red steps is big enough that we prefer to
avoid reinventing the wheel of pre- and post-processing.</p>
<p>Second, <code>macpan2</code> uses an engine plug-in architecture.
Models defined in the <a href="#engine-agnostic%20model%20specification%20language">engine-agnostic
model specification language</a> can be rendered in a particular
computational engine so that multiple computational approaches can be
used to generate modelling outputs for a single model definition. This
can be useful if different model outputs are more efficient or
convenient for different computational approaches. For example, engines
such as TMB that are capable of automatic differentiation are great for
fast optimization of parameters and for computing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ℛ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\mathcal{R}_0</annotation></semantics></math>
in models with arbitrary complexity, whereas other engines such as
Adaptive Tau are better at stochastic simulation techniques like the
Gillespie algorithm. Sometimes an engine will be unable to generate a
particular output at all or with sufficient difficulty on the part of
the user so as to render the use-case practically impossible. For
example, it is not possible to conveniently utilize differential
equation solvers in the TMB engine, limiting it to Euler or simple
RK4-type solvers. Being able to swap out the TMB engine for one based on
<code>deSolve</code> (or other similar package) would allow for more
convenient and accurate solutions to differential equations without
having to leave <code>macpan2</code>.</p>
<p>Third, TODO: describe how the model specification language can be
used to build up models modularly (e.g. swap out alternative
state-updaters as discussed above but also add in model structures like
age-groups and spatial structure to a simple unstructured model)</p>
</div>
<div class="section level3">
<h3 id="engine-agnostic-model-specification-language">Engine-Agnostic Model Specification Language<a class="anchor" aria-label="anchor" href="#engine-agnostic-model-specification-language"></a>
</h3>
<p>TODO</p>
</div>
<div class="section level3">
<h3 id="engine-specific-model-specification-languages">Engine-Specific Model Specification Languages<a class="anchor" aria-label="anchor" href="#engine-specific-model-specification-languages"></a>
</h3>
<p>TODO</p>
</div>
<div class="section level3">
<h3 id="general-dynamic-simulation-with-tmb">General Dynamic Simulation with TMB<a class="anchor" aria-label="anchor" href="#general-dynamic-simulation-with-tmb"></a>
</h3>
<p>One can <a href="#hello-world">define a generic set of update
steps</a> that are iterated to produce a dynamic simulation model in
TMB, and that can be used to generate model simulations.</p>
<p>This part of the package is general, stable, and flexible. It also
meets many modellers where they are, which is with the ability to write
down a set of transitions/state updates.</p>
<p>But it is not convenient if you would just like to simulate from it,
which is what the <a href="#model-library">model library</a> is for.</p>
</div>
<div class="section level3">
<h3 id="model-library">Model Library<a class="anchor" aria-label="anchor" href="#model-library"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="st">"starter_models"</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_tmb_library.html">mp_tmb_library</a></span><span class="op">(</span><span class="st">"sir"</span>, package <span class="op">=</span> <span class="st">"macpan2"</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_simulator.html">mp_simulator</a></span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">10</span>, outputs <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_trajectory.html">mp_trajectory</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    matrix time row col    value</span></span>
<span><span class="co">## 1       I    1   0   0 1.098000</span></span>
<span><span class="co">## 2       I    2   0   0 1.205169</span></span>
<span><span class="co">## 3       I    3   0   0 1.322276</span></span>
<span><span class="co">## 4       I    4   0   0 1.450133</span></span>
<span><span class="co">## 5       I    5   0   0 1.589599</span></span>
<span><span class="co">## 6       I    6   0   0 1.741573</span></span>
<span><span class="co">## 7       I    7   0   0 1.906995</span></span>
<span><span class="co">## 8       I    8   0   0 2.086833</span></span>
<span><span class="co">## 9       I    9   0   0 2.282085</span></span>
<span><span class="co">## 10      I   10   0   0 2.493761</span></span></code></pre>
<p>TODO:</p>
<ul class="task-list">
<li><label><input type="checkbox">Reuse the tools for the older
concept of starter models</label></li>
<li><label><input type="checkbox">Establish a
specification</label></li>
</ul>
</div>
<div class="section level3">
<h3 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h3>
<p>We will build a function, <code>mp_calibrate</code>, which takes (1)
an object for simulating model trajectories and (2) other information
for calibrating certain quantities of this model. This second type of
information is detailed in the following sections. The output of
<code>mp_calibrate</code> should be another object for simulating model
trajectories that contains new default parameter values given by fits
and additional stochasticity resulting from parameter estimation
uncertainty.</p>
<p>A big question with calibration is do we want there to be an
engine-agnostic DSL layer, or do we just want it to make sense for
engines where it makes sense? I think the latter, because otherwise we
are making things difficult. We can try to be wise making reusable
calibration machinery across engines if it comes to that.</p>
<div class="section level4">
<h4 id="specifying-data-to-fit">Specifying Data to Fit<a class="anchor" aria-label="anchor" href="#specifying-data-to-fit"></a>
</h4>
<p>A data frame (or data frames) containing observed (possibly uneven)
time series to compare with model simulations. What form should this
data frame take?</p>
<p>One option is the same format as the output of
<code>mp_trajectory</code>. This would have several benefits.</p>
<ul>
<li>Consistency with input and output formats, making it a little easier
to learn.</li>
<li>Easy to manipulate output into input for testing calibration
functionality.</li>
<li>Possibly simpler argument list to <code>mp_calibrate</code> because
we would just relate the observed data to simulated data with the same
name, of course we would still need an interface for distributional
assumptions.</li>
<li>Naturally handles missing values</li>
</ul>
<p>The main disadvantage of this is that format could differ from the
indexed vectors discussed below. But this disadvantage should be fixable
by having a way to convert indexed vector lists to the ‘long-matrices’
format. Actually yes … this should be totally fine. So the general
design is to have a generic S3 method for producing a ‘long-matrices’
data frame.</p>
</div>
<div class="section level4">
<h4 id="specifying-distributional-assumptions">Specifying Distributional Assumptions<a class="anchor" aria-label="anchor" href="#specifying-distributional-assumptions"></a>
</h4>
<p>Probably should be a few ways to do this depending on how many
different assumptions need to be made. At one extreme every observation
gets the same distribution, which is easily specified in an argument to
<code>mp_calibrate</code>. At the other extreme each observation gets
its own distribution (including distributional parameters like spread
and shape), which could be specified by adding additional columns to the
data frame with observed values. Designs for interfaces for use cases
that are somewhere between these two extremes seem less obvious.</p>
</div>
<div class="section level4">
<h4 id="specifying-parameters-to-fit">Specifying Parameters to Fit<a class="anchor" aria-label="anchor" href="#specifying-parameters-to-fit"></a>
</h4>
<p>There are two kinds of parameters to fit.</p>
<ul>
<li>Existing quantities to be fitted (e.g. <code>beta</code>, initial
number of susceptible individuals <code>S</code>).</li>
<li>Creating new quantities to be fitted (e.g. distributional scale
parameters declared along with <a href="#specifying-distributional-assumptions">distributional
asumptions</a>.</li>
</ul>
<p>The scale (e.g. log, logit) on which to fit these parameters must
also be specified.</p>
<p>The new distributional parameters should go into a new indexed vector
called something like <code>distributional_parameters</code>. (TODO:
more general name for new parameters that are part of the observation
model, e.g. convolution kernel parameters).</p>
</div>
</div>
<div class="section level3">
<h3 id="alternative-trajectory-solvers">Alternative Trajectory Solvers<a class="anchor" aria-label="anchor" href="#alternative-trajectory-solvers"></a>
</h3>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
be the state vector and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
be the vector of per-capita flow rates. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
be the vectors of from and to states – that is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>)
is the vector the same length of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
containing the elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
associated with the from (to) state for each flow. Therefore, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
flow is from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">z[i]</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">y[i]</annotation></semantics></math>
at per-capita rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">b[i]</annotation></semantics></math>.</p>
<p>The other way to think about it is that for a single flow,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
is the from state,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_j</annotation></semantics></math>
is the to state, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>k</mi></msub><annotation encoding="application/x-tex">b_k</annotation></semantics></math>
is the per-capita flow rate.</p>
<ul>
<li>Euler
<ul>
<li>Inflow:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><msub><mi>b</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_i b_k</annotation></semantics></math>
</li>
<li>Outflow:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><msub><mi>b</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_i b_k</annotation></semantics></math>
</li>
</ul>
</li>
<li>Mean Euler-Multimomial
<ul>
<li>Inflow</li>
<li>Outflow: $$</li>
</ul>
</li>
</ul>
<pre><code><span><span class="va">outflow</span> <span class="op">~</span> <span class="fu"><a href="../reference/engine_functions.html">group_sums</a></span><span class="op">(</span><span class="va">state</span> <span class="op">*</span> <span class="va">flow_rates</span>, <span class="va">from</span>, <span class="va">state</span><span class="op">)</span></span></code></pre>
<div class="section level4">
<h4 id="euler-step">Euler Step<a class="anchor" aria-label="anchor" href="#euler-step"></a>
</h4>
</div>
<div class="section level4">
<h4 id="mean-euler-multinomial-a-k-a--hazard-correction">Mean Euler-Multinomial (a.k.a. Hazard Correction)<a class="anchor" aria-label="anchor" href="#mean-euler-multinomial-a-k-a--hazard-correction"></a>
</h4>
</div>
<div class="section level4">
<h4 id="runge-kutta-4">Runge-Kutta 4<a class="anchor" aria-label="anchor" href="#runge-kutta-4"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="time-varying-parameters">Time-Varying Parameters<a class="anchor" aria-label="anchor" href="#time-varying-parameters"></a>
</h3>
<p>TODO</p>
</div>
<div class="section level3">
<h3 id="vectors-in-the-tmb-engine">Vectors in the TMB Engine<a class="anchor" aria-label="anchor" href="#vectors-in-the-tmb-engine"></a>
</h3>
<p>This is a TMB-engine-specific warm-up to <a href="#model-structure-and-bookkeeping">model structure</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_labels</span> <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span></span>
<span><span class="va">flow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    rate <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"infection"</span>, <span class="st">"recovery"</span><span class="op">)</span></span>
<span>  , from <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"S"</span>        , <span class="st">"I"</span>       <span class="op">)</span></span>
<span>  , to   <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"I"</span>        , <span class="st">"R"</span>       <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sir</span> <span class="op">=</span> <span class="fu"><a href="../reference/mp_tmb_model_spec.html">mp_tmb_model_spec</a></span><span class="op">(</span></span>
<span>    before <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">state</span><span class="op">[</span><span class="va">S</span><span class="op">]</span> <span class="op">~</span> <span class="va">N</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>      , <span class="va">state</span><span class="op">[</span><span class="va">I</span><span class="op">]</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>      , <span class="va">state</span><span class="op">[</span><span class="va">R</span><span class="op">]</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span>  , during <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">flow_rate</span><span class="op">[</span><span class="va">infection</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span></span>
<span>      , <span class="va">flow_rate</span><span class="op">[</span><span class="va">recovery</span><span class="op">]</span> <span class="op">~</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I</span><span class="op">]</span></span>
<span>      , <span class="va">state</span> <span class="op">~</span> <span class="va">state</span> <span class="op">+</span> <span class="fu"><a href="../reference/engine_functions.html">group_sums</a></span><span class="op">(</span><span class="va">flow_rate</span>, <span class="va">to</span>, <span class="va">state</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="../reference/engine_functions.html">group_sums</a></span><span class="op">(</span><span class="va">flow_rate</span>, <span class="va">from</span>, <span class="va">state</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  , default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      state     <span class="op">=</span> <span class="fu"><a href="../reference/mp_zero_vector.html">mp_zero_vector</a></span><span class="op">(</span><span class="va">state_labels</span><span class="op">)</span></span>
<span>    , flow_rate <span class="op">=</span> <span class="fu"><a href="../reference/mp_zero_vector.html">mp_zero_vector</a></span><span class="op">(</span><span class="va">flow</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span></span>
<span>    , N <span class="op">=</span> <span class="fl">100</span></span>
<span>    , beta <span class="op">=</span> <span class="fl">0.25</span></span>
<span>    , gamma <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span></span>
<span>  , integers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       from <span class="op">=</span> <span class="fu"><a href="../reference/mp_positions.html">mp_positions</a></span><span class="op">(</span><span class="va">flow</span><span class="op">$</span><span class="va">from</span>, <span class="va">state_labels</span><span class="op">)</span></span>
<span>     , to   <span class="op">=</span> <span class="fu"><a href="../reference/mp_positions.html">mp_positions</a></span><span class="op">(</span><span class="va">flow</span><span class="op">$</span><span class="va">to</span>  , <span class="va">state_labels</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">sir</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_simulator.html">mp_simulator</a></span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">10</span>, outputs <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_trajectory.html">mp_trajectory</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    matrix time row col    value</span></span>
<span><span class="co">## 1   state    1   I     1.147500</span></span>
<span><span class="co">## 2   state    2   I     1.316046</span></span>
<span><span class="co">## 3   state    3   I     1.508417</span></span>
<span><span class="co">## 4   state    4   I     1.727685</span></span>
<span><span class="co">## 5   state    5   I     1.977228</span></span>
<span><span class="co">## 6   state    6   I     2.260727</span></span>
<span><span class="co">## 7   state    7   I     2.582154</span></span>
<span><span class="co">## 8   state    8   I     2.945748</span></span>
<span><span class="co">## 9   state    9   I     3.355960</span></span>
<span><span class="co">## 10  state   10   I     3.817384</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="model-structure-and-bookkeeping">Model Structure and Bookkeeping<a class="anchor" aria-label="anchor" href="#model-structure-and-bookkeeping"></a>
</h3>
<p>Structured models are combinations of simpler modular model
components. For example one might combine an SIR model with an age-group
contact model to produce an age structured model. The modular model
components are called atomic models.</p>
<div class="section level4">
<h4 id="structure-in-expressions">Structure in Expressions<a class="anchor" aria-label="anchor" href="#structure-in-expressions"></a>
</h4>
<p>Models are composed of expression lists. Each expression in an
unstructured model can be converted into a structured expression to
create a structured model. For example, the following unstructured
expression defines the rate at which new infections emerge.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">S</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span></span></code></pre></div>
<p>Each symbol in this expression has a certain type within a structured
model, and this type determines how it gets translated into a structured
expression. The simplest structured model is one that collects
<code>S</code> and <code>I</code> into a <code>state</code> vector with
elements <code>S</code> and <code>I</code>. With this interpretation of
the <code>S</code> and <code>I</code> symbols, the structured infection
expression gets translated internally to the following.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span></span></code></pre></div>
<p>Here <code>S</code> and <code>I</code> become symbols for extracting
subsets of the <code>state</code> vector. In this case the expression
itself remains a scalar expression but two of the scalars are obtained
by extracting subsets of the <code>state</code> vector. It won’t take
much imagination to think of examples where multiple paths to infection
are required, and therefore the single scalar-valued infection
expression will be insufficient.</p>
<p>We will have a vector-valued expression, for example, in a model with
an expanded state vector that tracks the geographic location of
<code>S</code> and <code>I</code> individuals. For example, a two patch
model with an <code>east</code> and <code>west</code> patch would
involve a four-dimensional state vector with the following elements:
<code>S.east</code>, <code>S.west</code>, <code>I.east</code>, and
<code>I.west</code>. In this case we now have two scalar-valued
infection expressions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span><span class="op">[</span><span class="va">east</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.east</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">west</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.west</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span></span></code></pre></div>
<p>With two patches it is fine to write out all scalar-valued infection
expressions, but with more patches and with different types of structure
(e.g. age groups, symptom status, hospitalization, immunity status, etc
…) it will become crucial to have software that handles the bookkeeping
internally.</p>
<p>To see how easy this can be, note that this two-patch infection
expression can be powerfully and compactly expressed as our original
unstructured expression, <code>infection ~ beta * S * I / N</code>,
where <code>S = c(state[S.east], state[S.west])</code> and
<code>I = c(state[I.east], state[I.west])</code>.</p>
<p>Why is this powerful? Because it separates the math of the dynamic
mechanism, <code>infection ~ beta * S * I / N</code>, from the
bookkeeping required in structured models where the same mechanism is
applied again and again to different model strata. This is often how
modellers think. For example, I might have a location-structured SIR
model that I need to expand to be both age- and location-structured. In
this case, infection is still the same process, whereby a susceptible
individual contacts an infectious individual to create a flow from
susceptible individuals to infectious individuals. The same math applies
to all strata of the model. The boring but necessary part is to connect
the math to the bookkeeping associated with the model structure, and so
software should focus on making these bookkeeping changes as easy as
possible and with minimal changes required to the underlying
mathematical expressions.</p>
<p>Let’s look at more examples of infection, and watch the bookkeeping
get more annoying. In an age-stratified model with two age groups, we
now get four scalar-valued infection expressions of the form
<code>infection ~ beta * S * I / N</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span><span class="op">[</span><span class="va">young.young</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old</span><span class="op">]</span></span></code></pre></div>
<p>Here the first expression is for a young individual infecting an old
individual, the second is for an old individual infecting a young
individual, etc … Things get worse if we have two age groups in two
patches.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.east</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.east</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.east</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.east</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.east</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.west</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.west</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.west</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.west</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.west</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span></code></pre></div>
<p>This still isn’t so bad, as we just have the first four expressions
for <code>east</code> and the last four for <code>west</code>. But now
let’s introduce two symptom status categories: <code>mild</code> and
<code>severe</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.east.mild.mild</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.east.mild.mild</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.east.mild.severe</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.east.mild.severe</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.east.severe.mild</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.east.severe.mild</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.east.severe.severe</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.east.severe.severe</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.east.mild.mild</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.east.mild.mild</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.east.mild.severe</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.east.mild.severe</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.east.severe.mild</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.east.severe.mild</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.east.severe.severe</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.east.severe.severe</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.east</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.east.mild.mild</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.east.mild.mild</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.east.mild.severe</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.east.mild.severe</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.east.severe.mild</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.east.severe.mild</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.east.severe.severe</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.east.severe.severe</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.east.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.east.mild.mild</span><span class="op">]</span>         <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.east.mild.mild</span><span class="op">]</span>         <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.east.mild.severe</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.east.mild.severe</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.east.severe.mild</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.east.severe.mild</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.east.severe.severe</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.east.severe.severe</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.east</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.east.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.east</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.west.mild.mild</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.west.mild.mild</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.west.mild.severe</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.west.mild.severe</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.west.severe.mild</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.west.severe.mild</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.young.west.severe.severe</span><span class="op">]</span> <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.young.west.severe.severe</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.west.mild.mild</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.west.mild.mild</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.west.mild.severe</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.west.mild.severe</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.west.severe.mild</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.west.severe.mild</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">young.old.west.severe.severe</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">young.old.west.severe.severe</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.young.west</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.west.mild.mild</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.west.mild.mild</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.west.mild.severe</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.west.mild.severe</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.west.severe.mild</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.west.severe.mild</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.mild</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.young.west.severe.severe</span><span class="op">]</span>   <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.young.west.severe.severe</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.young.west.severe</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">young.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.west.mild.mild</span><span class="op">]</span>         <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.west.mild.mild</span><span class="op">]</span>         <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.west.mild.severe</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.west.mild.severe</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.west.severe.mild</span><span class="op">]</span>       <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.west.severe.mild</span><span class="op">]</span>       <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.mild</span><span class="op">]</span>     <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span>
<span><span class="va">infection</span><span class="op">[</span><span class="va">old.old.west.severe.severe</span><span class="op">]</span>     <span class="op">~</span> <span class="va">beta</span><span class="op">[</span><span class="va">old.old.west.severe.severe</span><span class="op">]</span>     <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">S.old.west</span><span class="op">]</span>   <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">I.old.west.severe</span><span class="op">]</span>   <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">old.west</span><span class="op">]</span></span></code></pre></div>
<p>This is intense. The names in square brackets get much less clear in
several ways as the model gets more structured. This lack of clarity
makes it difficult to see a variety of model assumptions by looking at
scalar-valued expressions. The <code>infection</code> and
<code>beta</code> vectors depend on two age categories and two symptom
statuses, but only one location. This is because young people can infect
old people (and vice versa), because mildly infectious people can cause
severe infection (and vice versa), and because infectious people in the
east cannot infect people in the west (and vice versa). For labels
associated with two ages, what does the first age mean, relative to the
second age? To discover this you need to know to look at the ages
associated with the <code>S</code> and <code>I</code> states, and once
you do this you can see that the first age category is associated with
the susceptible individual and the second with the infectious
individual. There is a related issue with symptom status, but it is
expressed differently because <code>S</code> individuals are not
structured by symptom status. In this case we match the second symptom
status associated with <code>infection</code> and <code>beta</code> to
the symptom status of the <code>I</code> states, which means that the
first symptom status implicitly refers to the status of the newly
infected individuals and not the infectious individuals. Another way to
look at this last issue is that <code>I</code> boxes play two different
roles. The first role is as an individual that infects an <code>S</code>
individual, and the second is as the individual that that <code>S</code>
individual becomes after it is infected. None of this is obvious from
the scalar-valued expressions above, and it is difficult to imagine a
clearer way to explicitly write each expression.</p>
<p>Our approach is to do the bookkeeping in a different way. In
particular we believe that a constructive approach to structure provides
a more comprehensible description, as we describe next. In brief, we
believe that a grammar for specifying the steps associated with adding
structure can be clearer than a description of the final structured
model.</p>
</div>
<div class="section level4">
<h4 id="constructive-descriptions-of-model-structure">Constructive Descriptions of Model Structure<a class="anchor" aria-label="anchor" href="#constructive-descriptions-of-model-structure"></a>
</h4>
<p>The first step to being more constructive is to have a better
representation of the structured vectors. Above we used
dot-concatenation to represent the model strata. For example, in the
two-patch SI model we have both epidemiological status and geographic
location in the state variable names: <code>S.east</code>,
<code>S.west</code>, <code>I.east</code>, and <code>I.west</code>. But
as the state vector gets more structured it becomes more convenient to
describe its variables using an index table, the rows of which describe
each state variable.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state</span> <span class="op">=</span> <span class="fu"><a href="../reference/mp_cartesian.html">mp_cartesian</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/mp_index.html">mp_index</a></span><span class="op">(</span>Epi <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/mp_index.html">mp_index</a></span><span class="op">(</span>Loc <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"east"</span>, <span class="st">"west"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">state</span></span></code></pre></div>
<pre><code><span><span class="co">##  Epi  Loc</span></span>
<span><span class="co">##    S east</span></span>
<span><span class="co">##    I east</span></span>
<span><span class="co">##    S west</span></span>
<span><span class="co">##    I west</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="../reference/mp_group.html">mp_group</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Epi"</span><span class="op">)</span></span></code></pre></div>
<p>With this representation we can get subsets of the state vector that
represent each epidemiological status.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mp_subset.html">mp_subset</a></span><span class="op">(</span><span class="va">state</span>, Epi <span class="op">=</span> <span class="st">"S"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Epi  Loc</span></span>
<span><span class="co">##    S east</span></span>
<span><span class="co">##    S west</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mp_subset.html">mp_subset</a></span><span class="op">(</span><span class="va">state</span>, Epi <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Epi  Loc</span></span>
<span><span class="co">##    I east</span></span>
<span><span class="co">##    I west</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="structured-vectors">Structured Vectors<a class="anchor" aria-label="anchor" href="#structured-vectors"></a>
</h4>
<p>These are column vectors, the rows of which</p>
</div>
</div>
<div class="section level3">
<h3 id="structure-encourages-reparameterization">Structure Encourages Reparameterization<a class="anchor" aria-label="anchor" href="#structure-encourages-reparameterization"></a>
</h3>
</div>
<div class="section level3">
<h3 id="alternative-engines">Alternative Engines<a class="anchor" aria-label="anchor" href="#alternative-engines"></a>
</h3>
<p>TODO</p>
</div>
<div class="section level3">
<h3 id="combining-expression-lists">Combining Expression Lists<a class="anchor" aria-label="anchor" href="#combining-expression-lists"></a>
</h3>
<p>Because expression lists are really just lists of expressions, they
can be combined as lists would normally be combined. In this example we
keep the dynamics of the si model separate from under-reporting and
reporting delay corrections to the raw prevalence (TODO: should really
use incidence).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://canmod.github.io/macpan2/">macpan2</a></span><span class="op">)</span></span>
<span><span class="va">si_dynamics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    transition_rate <span class="op">=</span> <span class="va">infection</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">S</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span></span>
<span>  , state_update <span class="op">=</span> <span class="va">S</span> <span class="op">~</span> <span class="va">S</span> <span class="op">-</span> <span class="va">infection</span></span>
<span>  , state_update <span class="op">=</span> <span class="va">I</span> <span class="op">~</span> <span class="va">I</span> <span class="op">+</span> <span class="va">infection</span></span>
<span><span class="op">)</span></span>
<span><span class="va">reporting_correction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  post_processing <span class="op">=</span> <span class="va">reports</span> <span class="op">~</span> <span class="fu"><a href="../reference/engine_functions.html">convolution</a></span><span class="op">(</span><span class="va">I</span>, <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">si</span> <span class="op">=</span> <span class="fu"><a href="../reference/mp_dynamic_model.html">mp_dynamic_model</a></span><span class="op">(</span></span>
<span>  expr_list <span class="op">=</span> <span class="fu">macpan2</span><span class="fu">:::</span><span class="fu">ExprList</span><span class="op">(</span>during <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="va">si_dynamics</span>, <span class="va">reporting_correction</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  unstruc_mats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">99</span>, I <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0.25</span>, N <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">si</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_dynamic_simulator.html">mp_dynamic_simulator</a></span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">10</span></span>
<span>    , mats_to_return <span class="op">=</span> <span class="st">"reports"</span></span>
<span>    , mats_to_save <span class="op">=</span> <span class="fu"><a href="../reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"reports"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/mp_trajectory.html">mp_trajectory</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     matrix time row col    value</span></span>
<span><span class="co">## 1  reports    1   0   0 0.873750</span></span>
<span><span class="co">## 2  reports    2   0   0 1.339617</span></span>
<span><span class="co">## 3  reports    3   0   0 1.669899</span></span>
<span><span class="co">## 4  reports    4   0   0 2.080193</span></span>
<span><span class="co">## 5  reports    5   0   0 2.589100</span></span>
<span><span class="co">## 6  reports    6   0   0 3.219119</span></span>
<span><span class="co">## 7  reports    7   0   0 3.997230</span></span>
<span><span class="co">## 8  reports    8   0   0 4.955432</span></span>
<span><span class="co">## 9  reports    9   0   0 6.131141</span></span>
<span><span class="co">## 10 reports   10   0   0 7.567307</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Walker, Weiguang Guan, Jen Freeman, Ben Bolker, Darren Flynn-Primrose.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
