<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Functions currently supported by the C++ TMB engine
for constructing expressions for defining model
simulations."><title>Engine Functions — engine_functions • macpan2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Engine Functions — engine_functions"><meta property="og:description" content="Functions currently supported by the C++ TMB engine
for constructing expressions for defining model
simulations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a>
    <a class="dropdown-item" href="../articles/example_models.html">Example Models</a>
    <a class="dropdown-item" href="../articles/calibration.html">Calibrating Compartmental Models to Data</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Engine Functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/canmod/macpan2/blob/HEAD/R/engine_functions.R" class="external-link"><code>R/engine_functions.R</code></a></small>
      <div class="d-none name"><code>engine_functions.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Functions currently supported by the C++ TMB engine
for constructing expressions for defining model
simulations.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The quickest way to experiment with these functions is
to use the <code><a href="engine_eval.html">engine_eval</a></code> function, as in the
following example that calculates a force of infection.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> beta <span class="sc">*</span> I <span class="sc">/</span> N</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  , <span class="at">beta =</span> <span class="fl">0.25</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  , <span class="at">I =</span> <span class="fl">1e3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">N =</span> <span class="fl">1e7</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>To produce a simulation using these functions, one may
use <code><a href="simple_sims.html">simple_sims</a></code>.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simple_sims</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_exprs =</span> <span class="fu">list</span>(x <span class="sc">~</span> x <span class="sc">-</span> <span class="fl">0.9</span> <span class="sc">*</span> x),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_steps =</span> <span class="dv">5</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre><p></p></div><div class="section">
<h3 id="elementwise-binary-operators">Elementwise Binary Operators<a class="anchor" aria-label="anchor" href="#elementwise-binary-operators"></a></h3>


<p>Elementwise binary operators take two matrix-valued
arguments and apply a binary operator (e.g. <code>+</code>, <code>*</code>)
to each set of corresponding elements, and return the
corresponding matrix-valued output containing the
resulting elements. What does 'corresponding' mean? If
the two matrix-valued arguments have the same shape
(same number of rows and columns), then two elements
correspond if they occur in the same row and column
position in the two matrices. If the two matrices are
not of the same shape but there is one row and/or
one column in either matrix, then the singleton rows
and columns are recycled sufficiently many times
so that they match the shape of the other matrix. If
after recycling singleton rows and columns the
matrices are still of different shape, then an error
is thrown and the matrices are said to be incompatible.</p><div class="section">
<h4 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h4>

<ul><li><p><code>x + y</code></p></li>
<li><p><code>x - y</code></p></li>
<li><p><code>x * y</code></p></li>
<li><p><code>x / y</code></p></li>
<li><p><code>x ^ y</code></p></li>
</ul></div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>

<ul><li><p><code>x</code> -- Any matrix with dimensions compatible with <code>y</code>.</p></li>
<li><p><code>y</code> -- Any matrix with dimensions compatible with <code>x</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="return">Return<a class="anchor" aria-label="anchor" href="#return"></a></h4>

<ul><li><p>A matrix with the binary operator applied elementwise
after any necessary recycling of rows and/or columns.</p></li>
</ul></div>

<div class="section">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> y <span class="sc">*</span> z, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">z =</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> y), <span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="unary-elementwise-math">Unary Elementwise Math<a class="anchor" aria-label="anchor" href="#unary-elementwise-math"></a></h3>

<div class="section">
<h4 id="functions-1">Functions<a class="anchor" aria-label="anchor" href="#functions-1"></a></h4>

<ul><li><p><code>log(x)</code> -- Natural logarithm</p></li>
<li><p><code>exp(x)</code> -- Exponential function</p></li>
<li><p><code>cos(x)</code> -- Cosine function</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>

<ul><li><p><code>x</code> -- Any matrix</p></li>
</ul></div>

<div class="section">
<h4 id="return-1">Return<a class="anchor" aria-label="anchor" href="#return-1"></a></h4>

<ul><li><p>A matrix with the same dimensions as <code>x</code>, with the
unary function applied elementwise.</p></li>
</ul></div>

<div class="section">
<h4 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">log</span>(y), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.5</span>))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="integer-sequences">Integer Sequences<a class="anchor" aria-label="anchor" href="#integer-sequences"></a></h3>

<div class="section">
<h4 id="functions-2">Functions<a class="anchor" aria-label="anchor" href="#functions-2"></a></h4>

<ul><li><p><code>from:to</code> -- Inclusive and ordered sequence of
integers between two bounds.</p></li>
<li><p><code>seq(from, length, by)</code> -- Ordered sequence of
integers with equal spacing between adjacent
values.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>

<ul><li><p><code>from</code> -- Scalar integer giving the first integer
in the sequence.</p></li>
<li><p><code>to</code> -- Scalar integer giving the last integer in
the sequence.</p></li>
<li><p><code>length</code> -- Number of integers in the sequence.</p></li>
<li><p><code>by</code> -- Scalar giving the difference
between adjacent values in the sequence.</p></li>
</ul></div>

<div class="section">
<h4 id="return-2">Return<a class="anchor" aria-label="anchor" href="#return-2"></a></h4>

<ul><li><p>Column vector with a sequence of integers.</p></li>
</ul></div>

<div class="section">
<h4 id="details-1">Details<a class="anchor" aria-label="anchor" href="#details-1"></a></h4>


<p>The colon operator works much like the base R version
<code><a href="https://rdrr.io/r/base/Colon.html" class="external-link">:</a></code>. It takes two scalar-valued integers
and returns a column vector with all integers between
the two inputs.</p>
<p>The <code>seq</code> function is a little different from the
base R default, <code>seq</code>, in that it
allows the user precise control over the length of
the output through the <code>length</code> argument. The
base R function gives the user this option, but not
as the default.</p>
</div>

<div class="section">
<h4 id="examples-2">Examples<a class="anchor" aria-label="anchor" href="#examples-2"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>))</span></code></pre><p></p></div>
<p>Replicate Elements</p>
</div>

<div class="section">
<h4 id="functions-3">Functions<a class="anchor" aria-label="anchor" href="#functions-3"></a></h4>

<ul><li><p><code>rep(x, times)</code> -- Replicate a column vector a
number of times, by repeatedly stacking it on top of
itself.</p></li>
<li><p><code>rep_each</code> -- Not yet developed.</p></li>
<li><p><code>rep_length</code> -- Not yet developed.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>

<ul><li><p><code>x</code> -- A scalar-valued variable to repeat.</p></li>
<li><p><code>times</code> -- A scalar-valued integer variable giving
the number of times to repeat <code>x</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="return-3">Return<a class="anchor" aria-label="anchor" href="#return-3"></a></h4>

<ul><li><p>Column vector with <code>times</code> copies of <code>x</code> stacked
on top of each other.</p></li>
</ul></div>

<div class="section">
<h4 id="examples-3">Examples<a class="anchor" aria-label="anchor" href="#examples-3"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="matrix-multiplication">Matrix Multiplication<a class="anchor" aria-label="anchor" href="#matrix-multiplication"></a></h3>

<div class="section">
<h4 id="functions-4">Functions<a class="anchor" aria-label="anchor" href="#functions-4"></a></h4>

<ul><li><p><code>x %*% y</code> -- Standard matrix multiplication.</p></li>
<li><p><code>x %x% y</code> -- Kronecker product</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>

<ul><li><p><code>x</code> -- A matrix. For the standard product, <code>x</code>
must have as many columns as <code>y</code> has rows.</p></li>
<li><p><code>y</code> -- A matrix. For standard product, <code>y</code>
must have as many rows as <code>x</code> has columns.</p></li>
</ul></div>

<div class="section">
<h4 id="return-4">Return<a class="anchor" aria-label="anchor" href="#return-4"></a></h4>

<ul><li><p>The matrix product of <code>x</code> and <code>y</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="examples-4">Examples<a class="anchor" aria-label="anchor" href="#examples-4"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%*%</span> <span class="fu">t</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%x%</span> <span class="fu">t</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="parenthesis">Parenthesis<a class="anchor" aria-label="anchor" href="#parenthesis"></a></h3>


<p>The order of operations can be enforced in the usual
way with round parentheses, <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">(</a></code>.</p>
</div>

<div class="section">
<h3 id="reshaping-and-combining-matrices">Reshaping and Combining Matrices<a class="anchor" aria-label="anchor" href="#reshaping-and-combining-matrices"></a></h3>

<div class="section">
<h4 id="functions-5">Functions<a class="anchor" aria-label="anchor" href="#functions-5"></a></h4>

<ul><li><p><code>c(...)</code> -- Stack columns of arguments into a
single column vector.</p></li>
<li><p><code>cbind(...)</code> -- Create a matrix containing all of
the columns of a group of matrices with the same
number of rows.</p></li>
<li><p><code>rbind(...)</code> -- Create a matrix containing all of
the rows of a group of matrices with the same number
of columns.</p></li>
<li><p><code>matrix(x, rows, cols)</code> -- Reshape a matrix to have
<code>rows</code> rows and <code>cols</code> columns. The input <code>x</code> must
have <code>rows * cols</code> elements.</p></li>
<li><p><code>t(x)</code> -- Standard matrix transpose.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>

<ul><li><p><code>...</code> -- Any number of dimensionally consistent
matrices. The definition of dimensionally consistent
depends on the function.</p></li>
<li><p><code>x</code> -- Can be any matrix for <code>t</code>, but for <code>matrix</code>
it must have <code>rows * cols</code> elements.</p></li>
<li><p><code>rows</code> -- Scalar integer giving the number of
rows in the output.</p></li>
<li><p><code>cols</code> -- Scalar integer giving the number of
columns in the output.</p></li>
</ul></div>

<div class="section">
<h4 id="return-5">Return<a class="anchor" aria-label="anchor" href="#return-5"></a></h4>

<ul><li><p>A combined or reshaped matrix.</p></li>
</ul></div>

<div class="section">
<h4 id="details-2">Details<a class="anchor" aria-label="anchor" href="#details-2"></a></h4>


<p>Any number of column vectors can be combined into a
bigger column vector.</p>
<p>Column and row vectors of the same length can be
combined using the <code>cbind</code> and
<code>rbind</code> functions respectively</p>
<p>The <code>matrix</code> function can be used to redefine the
numbers of rows and columns to use for arranging
the values of a matrix. It works similarly to
the base R <code>matrix</code> function in that it
takes the same arguments.
On the other hand, this function differs substantially
from the base R version in that it must be filled
by column and there is no <code>byrow</code> option.</p>
<p>Matrices can be transposed with the usual
function, <code>t</code>.</p>
</div>

<div class="section">
<h4 id="examples-5">Examples<a class="anchor" aria-label="anchor" href="#examples-5"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">c</span>(a, b, c), <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">c =</span> <span class="fu">matrix</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">cbind</span>(a, <span class="dv">10</span> <span class="sc">+</span> a), <span class="at">a =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">rbind</span>(a, <span class="dv">10</span> <span class="sc">+</span> a), <span class="at">a =</span> <span class="fu">t</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">t</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="matrix-diagonals">Matrix Diagonals<a class="anchor" aria-label="anchor" href="#matrix-diagonals"></a></h3>

<div class="section">
<h4 id="functions-6">Functions<a class="anchor" aria-label="anchor" href="#functions-6"></a></h4>

<ul><li><p><code>to_diag(x)</code> -- Create a diagonal matrix by setting
the diagonal to a column vector, <code>x</code>.</p></li>
<li><p><code>from_diag(x)</code> -- Extract the diagonal from a
matrix, <code>x</code>, and return the diagonal as a column
vector.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>

<ul><li><p><code>x</code> -- Any matrix (for <code>from_diag</code>) or a
column vector (for <code>to_diag</code>). It is common to assume
that <code>x</code> is square for <code>from_diag</code> but this is
not required.</p></li>
</ul></div>

<div class="section">
<h4 id="return-6">Return<a class="anchor" aria-label="anchor" href="#return-6"></a></h4>

<ul><li><p><code>to_diag(x)</code> -- Diagonal matrix with <code>x</code> on the
diagonal.</p></li>
<li><p><code>from_diag(x)</code> -- Column vector containing the
diagonal of <code>x</code>. A value is considered to be on
the diagonal if it has a row index equal to
the column index.</p></li>
</ul></div>

<div class="section">
<h4 id="details-3">Details<a class="anchor" aria-label="anchor" href="#details-3"></a></h4>


<p>The <code>to_diag</code> function can be used to produce a
diagonal matrix by setting a column vector equal
to the desired diagonal. The <code>from_diag</code> does
(almost) the opposite, which is to get a column vector
containing the diagonal of an existing matrix.</p>
</div>

<div class="section">
<h4 id="examples-6">Examples<a class="anchor" aria-label="anchor" href="#examples-6"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span><span class="fu">from_diag</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">3</span>)))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span><span class="fu">to_diag</span>(<span class="fu">from_diag</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">3</span>))))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span><span class="fu">from_diag</span>(<span class="fu">to_diag</span>(<span class="fu">from_diag</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">3</span>)))))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="summarizing-matrix-values">Summarizing Matrix Values<a class="anchor" aria-label="anchor" href="#summarizing-matrix-values"></a></h3>

<div class="section">
<h4 id="functions-7">Functions<a class="anchor" aria-label="anchor" href="#functions-7"></a></h4>

<ul><li><p><code>sum(...)</code> -- Sum all of the elements of all of the
matrices passed to <code>...</code>.</p></li>
<li><p><code>col_sums(x)</code> -- Row vector containing the sums
of each column.</p></li>
<li><p><code>row_sums(x)</code> -- Column vector containing the sums
of each row.</p></li>
<li><p><code>group_sums(x, f, n)</code> -- Column vector containing the
sums of groups of elements in <code>x</code>. The groups are
determined by the integers in <code>f</code> and the order of
the sums in the output is determined by these
integers.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>

<ul><li><p><code>...</code> -- Any number of matrices of any shape.</p></li>
<li><p><code>x</code> -- A matrix of any dimensions, except for
<code>group_sums</code> that expects <code>x</code> to be a column vector.</p></li>
<li><p><code>f</code> -- A column vector the same length as <code>x</code>
containing integers between <code>0</code> and <code>m-1</code>, given <code>m</code>
unique groups. Elements of <code>f</code> refer to the indices
of <code>x</code> that will be grouped and summed.</p></li>
<li><p><code>n</code> -- A column vector of length <code>m</code>. If <code>f</code> does
not contain group <code>k</code> in <code>[0, m-1]</code>, <code>group_sums</code> skips
this group and the output at index <code>k+1</code> is <code>n[k+1]</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="return-7">Return<a class="anchor" aria-label="anchor" href="#return-7"></a></h4>

<ul><li><p>A matrix containing sums of various groups of
the elements of <code>x</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="details-4">Details<a class="anchor" aria-label="anchor" href="#details-4"></a></h4>


<p>The standard <code><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></code> and
<code><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></code> can be used, but they have
slightly different behaviour from their base R
versions. In particular, the <code>rowSums</code> function
returns a column vector and the <code>colSums</code> function
returns a row vector. If a specific shape is required
then the transpose <code>t</code> function must be
explicitly used.</p>
</div>

<div class="section">
<h4 id="examples-7">Examples<a class="anchor" aria-label="anchor" href="#examples-7"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">sum</span>(y), <span class="at">y =</span> y)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">sum</span>(x, y, A), <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">A =</span> A)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">col_sums</span>(A), <span class="at">A =</span> A)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">row_sums</span>(A), <span class="at">A =</span> A)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">group_sums</span>(x, f, n), <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">f =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="extracting-matrix-elements">Extracting Matrix Elements<a class="anchor" aria-label="anchor" href="#extracting-matrix-elements"></a></h3>

<div class="section">
<h4 id="functions-8">Functions<a class="anchor" aria-label="anchor" href="#functions-8"></a></h4>

<ul><li><p><code>x[i,j]</code> -- Matrix containing a subset
of the rows and columns of <code>x</code>.</p></li>
<li><p><code>block(x,i,j,n,m)</code> -- Matrix containing a
contiguous subset of rows and columns of <code>x</code>
<a href="https://eigen.tuxfamily.org/dox/group__TutorialBlockOperations.html" class="external-link">https://eigen.tuxfamily.org/dox/group__TutorialBlockOperations.html</a></p></li>
</ul></div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>

<ul><li><p><code>x</code> -- Any matrix.</p></li>
<li><p><code>i</code> -- An integer column vector (for <code>[</code>) or
integer scalar (for <code>block</code>) containing the indices
of the rows to extract (for <code>[</code>) or the index of the
first row to extract (for <code>block</code>).</p></li>
<li><p><code>j</code> -- An integer column vector (for <code>[</code>) or
integer scalar (for <code>block</code>) containing the indices
of the columns to extract (for <code>[</code>) or the index of
the first column to extract (for <code>block</code>).</p></li>
<li><p><code>n</code> -- Number of rows in the block to return.</p></li>
<li><p><code>m</code> -- Number of columns in the block to return.</p></li>
</ul></div>

<div class="section">
<h4 id="return-8">Return<a class="anchor" aria-label="anchor" href="#return-8"></a></h4>

<ul><li><p>A matrix containing a subset of the rows and columns
in <code>x</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="details-5">Details<a class="anchor" aria-label="anchor" href="#details-5"></a></h4>


<p>Note that zero-based indexing is used
so the first row/column gets index, <code>0</code>, etc.</p>
</div>

<div class="section">
<h4 id="examples-8">Examples<a class="anchor" aria-label="anchor" href="#examples-8"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> A[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">2</span>], <span class="at">A =</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">3</span>))</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="accessing-past-values-in-the-simulation-history">Accessing Past Values in the Simulation History<a class="anchor" aria-label="anchor" href="#accessing-past-values-in-the-simulation-history"></a></h3>


<p>For matrices with their simulation history saved,
it is possible to bind the rows or columns of past
versions of such matrices into a single matrix.</p><div class="section">
<h4 id="functions-9">Functions<a class="anchor" aria-label="anchor" href="#functions-9"></a></h4>

<ul><li><p><code>rbind_lag(x, lag, t_min)</code> -- Bind the rows of versions of
<code>x</code> that were recorded at the end of all
simulation iterations corresponding to time lags given
by integers in <code>lag</code>.</p></li>
<li><p><code>rbind_time(x, t, t_min)</code> -- Bind the rows of versions of
<code>x</code> that were recorded at the end of all
simulation iterations corresponding to integers in
<code>t</code>.</p></li>
<li><p><code>cbind_lag(x, lag, t_min)</code> -- Bind the columns of versions of
<code>x</code> that were recorded at the end of all
simulation iterations corresponding to time lags given
by integers in <code>lag</code>. (TODO -- cbind_lag is not developed yet)</p></li>
<li><p><code>cbind_time(x, t, t_min)</code> -- Bind the columns of versions of
<code>x</code> that were recorded at the end of all
simulation iterations corresponding to integers in
<code>t</code>. (TODO -- cbind_lag is not developed yet)</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>

<ul><li><p><code>x</code> -- Any matrix with saved history such that the
number of columns (for <code>rbind_*</code>) or rows (for
<code>cbind_*</code>) does not change throughout the simulation.</p></li>
<li><p><code>lag</code> -- Integer vector giving numbers
of time steps before the current step to obtain
past values of <code>x</code>.</p></li>
<li><p><code>t</code> -- Integer vector giving time steps
at which to obtain past values of <code>x</code>.</p></li>
<li><p><code>t_min</code> -- Integer giving the minimum time step
that is allowed to be accessed. All time-steps in <code>t</code>
or implied by <code>lag</code> that are before <code>t_min</code> are ignored.</p></li>
</ul></div>

<div class="section">
<h4 id="return-9">Return<a class="anchor" aria-label="anchor" href="#return-9"></a></h4>

<ul><li><p>A matrix containing values of <code>x</code> from past times.</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="time-indexing">Time Indexing<a class="anchor" aria-label="anchor" href="#time-indexing"></a></h3>


<p>Get the index of current or lagged time step or
the index of the current time group. A time group
is a contiguous set of time steps defined by two
change points.</p><div class="section">
<h4 id="functions-10">Functions<a class="anchor" aria-label="anchor" href="#functions-10"></a></h4>

<ul><li><p><code>time_step(lag)</code>: Get the time-step associated
with a particular lag from the current time-step.
If the lagged time-step is less than zero, the
function returns zero.</p></li>
<li><p><code>time_group(index, change_points)</code>: Update the
<code>index</code> associated with the current time group.
The current group is defined by the minimum
of all elements of <code>change_points</code> that are
greater than the current time step. The time group
<code>index</code> is the index associated with this element.
Please see the examples below, they are easier
to understand than this explanation.</p></li>
<li><p><code>time_var(x, change_points, index)</code>: An improvement
to <code>time_group</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-10">Arguments<a class="anchor" aria-label="anchor" href="#arguments-10"></a></h4>

<ul><li><p><code>x</code>: Column vector representing a time series.
<code>time_var</code> will return the value of <code>x</code> corresponding
to element in <code>change_points</code> that contains the
current time.</p></li>
<li><p><code>lag</code>: Number of time-steps to look back for
the time-step to return.</p></li>
<li><p><code>index</code>: Index associated with the current time
group.</p></li>
<li><p><code>change_points</code>: Increasing column vector of
time steps giving the lower bound of each time
group.</p></li>
</ul></div>

<div class="section">
<h4 id="return-10">Return<a class="anchor" aria-label="anchor" href="#return-10"></a></h4>


<p>A 1-by-1 matrix with the time-step <code>lag</code> steps
ago, or with zero if <code>t+1 &lt; lag</code></p>
</div>

<div class="section">
<h4 id="examples-9">Examples<a class="anchor" aria-label="anchor" href="#examples-9"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simple_sims</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_exprs =</span> <span class="fu">list</span>(x <span class="sc">~</span> <span class="fu">time_step</span>(<span class="dv">0</span>)),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_steps =</span> <span class="dv">10</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> empty_matrix</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> <span class="fu">simple_sims</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_exprs =</span> <span class="fu">list</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    j <span class="sc">~</span> <span class="fu">time_group</span>(j, change_points),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    time_varying_parameter <span class="sc">~</span> time_variation_schedule[j]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_steps =</span> <span class="dv">10</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">j =</span> <span class="dv">0</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">change_points =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">7</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_variation_schedule =</span> <span class="fu">c</span>(<span class="dv">42</span>, pi, <span class="fu">sqrt</span>(<span class="dv">2</span>)),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_varying_parameter =</span> empty_matrix</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="convolution">Convolution<a class="anchor" aria-label="anchor" href="#convolution"></a></h3>


<p>One may take the convolution of each element in a
matrix, x, over simulation time using a kernel, k.
There are two arguments of this function.</p><div class="section">
<h4 id="functions-11">Functions<a class="anchor" aria-label="anchor" href="#functions-11"></a></h4>

<ul><li><p><code>convolution(x, k)</code></p></li>
</ul></div>

<div class="section">
<h4 id="arguments-11">Arguments<a class="anchor" aria-label="anchor" href="#arguments-11"></a></h4>

<ul><li><p><code>x</code> -- The matrix containing elements to be
convolved.</p></li>
<li><p><code>k</code> -- A column vector giving the convolution kernel.</p></li>
</ul></div>

<div class="section">
<h4 id="return-11">Return<a class="anchor" aria-label="anchor" href="#return-11"></a></h4>


<p>A matrix the same size as <code>x</code> but with the
convolutions, \(y_{ij}\), of each element,
\(x_{ij}\), given by the following.</p>
<p>$$y_{ij} = \sum_{\tau = 0} x_{ij}(t-\tau) k(\tau)$$</p>
<p>unless \(t &lt; \tau\), in which case,</p>
<p>$$y_{ij} = $$</p>
<p>where \(y_{ij}\) is the convolution,
\(x_{ij}(t)\) is the value of \(x_{ij}\) at time step, \(t\),
\(k(\tau)\) is the value of the kernel at lag, \(\tau\),
and \(\lambda\) is the length of the kernel.</p>
</div>

<div class="section">
<h4 id="details-6">Details<a class="anchor" aria-label="anchor" href="#details-6"></a></h4>


<p>If any empty matrices are encountered when looking
back in time, they are treated as matrices with all
zeros. Similarly, any matrices encounte
of <code>x</code></p>
</div>


</div>

<div class="section">
<h3 id="clamp">Clamp<a class="anchor" aria-label="anchor" href="#clamp"></a></h3>


<p>Smoothly clamp the elements of a matrix so that they
do not get closer to 0 than a tolerance, <code>eps</code>, with
a default of 1e-12. The output of the <code>clamp</code>
function is as follows.</p><div class="section">
<h4 id="functions-12">Functions<a class="anchor" aria-label="anchor" href="#functions-12"></a></h4>

<ul><li><p><code>clamp(x, eps)</code></p></li>
</ul></div>

<div class="section">
<h4 id="arguments-12">Arguments<a class="anchor" aria-label="anchor" href="#arguments-12"></a></h4>

<ul><li><p><code>x</code> : A matrix with elements that should remain positive.</p></li>
<li><p><code>eps</code> : A small positive number giving the
theoretical minimum of the elements in the returned
matrix.</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="probability-densities">Probability Densities<a class="anchor" aria-label="anchor" href="#probability-densities"></a></h3>


<p>All probability densities have the same first two
arguments.</p><ul><li><p><code>observed</code></p></li>
<li><p><code>simulated</code></p></li>
</ul><p>The <code>simulated</code> argument gives a matrix of means for
the <code>observed</code> values at which the densities are
being evaluated. Additional arguments are other
distributional parameters such as the standard
deviation or dispersion parameter. All densities
are given as log-densities, so if you would like
the density itself you must pass the result through
the <code>exp</code> function.</p>
<p>If the <code>simulated</code> matrix or the additional parameter
matrices have either a single row or
single column, these singleton rows and columns are
repeated to match the number of rows and columns in
the <code>observed</code> matrix. This feature allows one
to do things like specify a single common mean for
several values.</p><div class="section">
<h4 id="functions-13">Functions<a class="anchor" aria-label="anchor" href="#functions-13"></a></h4>

<ul><li><p><code>dpois(observed, simulated)</code> -- Log of the Poisson density
based on this <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gaa1ed15503e1441a381102a8c4c9baaf1" class="external-link">dpois</a>
TMB function.</p></li>
<li><p><code>dnbinom(observed, simulated, over_dispersion)</code> --
Log of the negative binomial density based on this <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#ga76266c19046e04b651fce93aa0810351" class="external-link">dnbinom</a>
TMB function. To get the variance that this function
requires we use this expression, <code>simulated + simulated^2/over_dispersion</code>,
following p.165 in this <a href="https://ms.mcmaster.ca/~bolker/emdbook/book.pdf" class="external-link">book</a></p></li>
<li><p><code>dnorm(observed, simulated, standard_deviation)</code> --
Log of the normal density based on this <a href="https://kaskr.github.io/adcomp/dnorm_8hpp.html" class="external-link">dnorm</a>
TMB function.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-13">Arguments<a class="anchor" aria-label="anchor" href="#arguments-13"></a></h4>

<ul><li><p><code>observed</code> -- Matrix of observed values
at which the density is being evaluated.</p></li>
<li><p><code>simulated</code> -- Matrix of distributional means,
with singleton rows and columns recycled to match
the numbers of rows and columns in <code>observed</code>.</p></li>
<li><p><code>over_dispersion</code> -- Over-dispersion parameter
given by <code>(simulated/standard_deviation)^2 - simulated)</code>.</p></li>
<li><p><code>standard_deviation</code> -- Standard deviation parameter.</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="pseudo-random-number-generators">Pseudo-Random Number Generators<a class="anchor" aria-label="anchor" href="#pseudo-random-number-generators"></a></h3>


<p>All random number generator functions have <code>mean</code>
as the first argument. Subsequent arguments give
additional distributional parameters.
Singleton rows and columns in the matrices passed to
the additional distributional parameters are recycled
so that all arguments have the same number of rows
and columns. All functions return a matrix the same
shape as <code>mean</code> but with pseudo-random numbers
deviating from each mean in the <code>mean</code> matrix.</p><div class="section">
<h4 id="functions-14">Functions<a class="anchor" aria-label="anchor" href="#functions-14"></a></h4>

<ul><li><p><code>rpois(mean)</code> -- Pseudo-random Poisson distributed
values.</p></li>
<li><p><code>rnbinom(mean, over_dispersion)</code> -- Pseudo-random
negative binomially distributed values.</p></li>
<li><p><code>rnorm(mean, standard_deviation)</code> -- Pseudo-random
normal values.</p></li>
</ul></div>

<div class="section">
<h4 id="arguments-14">Arguments<a class="anchor" aria-label="anchor" href="#arguments-14"></a></h4>

<ul><li><p><code>mean</code> -- Matrix of means about which to simulate
pseudo-random variation.</p></li>
<li><p><code>over_dispersion</code> -- Matrix of over-dispersion parameters
given by <code>(simulated/standard_deviation)^2 - simulated)</code>.</p></li>
<li><p><code>standard_deviation</code> -- Matrix of standard deviation parameters.</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="assign">Assign<a class="anchor" aria-label="anchor" href="#assign"></a></h3>


<p>Assign values to a subset of the elements in a matrix.</p><div class="section">
<h4 id="functions-15">Functions<a class="anchor" aria-label="anchor" href="#functions-15"></a></h4>

<ul><li><p><code>assign(x, i, j, v)</code></p></li>
</ul></div>

<div class="section">
<h4 id="arguments-15">Arguments<a class="anchor" aria-label="anchor" href="#arguments-15"></a></h4>

<ul><li><p><code>x</code> -- Matrix with elements that are to be updated
by the values in <code>v</code>.</p></li>
<li><p><code>i</code> -- Column vector of row indices pointing to
the elements of <code>x</code> to be updated. These indices are
paired with those in <code>v</code>. If the length of
<code>i</code> does not equal that of <code>v</code>, then it must have a
single index that gets paired with every element of
<code>v</code>.</p></li>
<li><p><code>j</code> -- Column vector of column indices pointing to
the elements of <code>x</code> to be updated. These indices are
paired with those in <code>v</code>. If the length of
<code>j</code> does not equal that of <code>v</code>, then it must have a
single index that gets paired with every element of
<code>v</code>.</p></li>
<li><p><code>v</code> -- Column vector of values to replace elements
of <code>x</code> at locations given by <code>i</code> and <code>j</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="return-12">Return<a class="anchor" aria-label="anchor" href="#return-12"></a></h4>


<p>The <code>assign</code> function is not called for its return
value, which is an <code><a href="empty_matrix.html">empty_matrix</a></code>, but
rather to modify <code>x</code> but replacing some of its
components with those in <code>v</code>.</p>
</div>

<div class="section">
<h4 id="examples-10">Examples<a class="anchor" aria-label="anchor" href="#examples-10"></a></h4>


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> x <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x =</span> x)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> x <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x =</span> x, <span class="at">.matrix_to_return =</span> <span class="st">"x"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">assign</span>(x, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">100</span>), <span class="at">x =</span> x, <span class="at">.matrix_to_return =</span> <span class="st">"x"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span> <span class="fu">assign</span>(x</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  , <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  , <span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  , <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>), <span class="at">x =</span> x, <span class="at">.matrix_to_return =</span> <span class="st">"x"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span></code></pre><p></p></div>
</div>


</div>

<div class="section">
<h3 id="unpack">Unpack<a class="anchor" aria-label="anchor" href="#unpack"></a></h3>


<p>Unpack elements of a matrix into smaller matrices.</p><div class="section">
<h4 id="functions-16">Functions<a class="anchor" aria-label="anchor" href="#functions-16"></a></h4>

<ul><li><p><code>unpack(x, ...)</code></p></li>
</ul></div>

<div class="section">
<h4 id="arguments-16">Arguments<a class="anchor" aria-label="anchor" href="#arguments-16"></a></h4>

<ul><li><p><code>x</code> -- Matrix with elements to be distributed to
the matrices passed through <code>...</code>.</p></li>
<li><p><code>...</code> -- Matrices with elements to be replaced by
the values of elements in <code>x</code> in column-major order.
These matrices must be named matrices and not
computed on the fly using expressions. Note that even
subsetting (e.g. <code>unpack(x, y[0], y[3])</code>) counts as
an expression. This use-case would require the
<code>assign</code> function
<code>assign(y, c(0, 3), 0, x)</code>.</p></li>
</ul></div>

<div class="section">
<h4 id="return-13">Return<a class="anchor" aria-label="anchor" href="#return-13"></a></h4>


<p>The <code>unpack</code> function is not called for its return
value, which is an <code><a href="empty_matrix.html">empty_matrix</a></code>, but
rather to modify the matrices in <code>...</code> by replacing
at least some of its components with those in <code>x</code>.</p>
</div>

<div class="section">
<h4 id="examples-11">Examples<a class="anchor" aria-label="anchor" href="#examples-11"></a></h4>


<p>Here we fill a matrix with integers from <code>1</code> to <code>12</code>
and then unpack them one-at-a-time into two
column vectors, <code>x</code> and <code>y</code>. By returning <code>y</code>
we see the integers after the first three were
used up by <code>x</code>.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine_eval</span>(<span class="sc">~</span><span class="fu">unpack</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">3</span>, <span class="dv">4</span>), x, y)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  , <span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  , <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">.matrix_to_return =</span> <span class="st">"y"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre><p></p></div>
</div>


</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Steve Walker, Weiguang Guan, Ben Bolker, Jen Freeman, Darren Flynn-Primrose.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

