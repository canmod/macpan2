<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate Dynamical Model Trajectories — mp_trajectory • macpan2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate Dynamical Model Trajectories — mp_trajectory"><meta name="description" content='Return simulations of the trajectory of the output
variables of a dynamical model simulator. To see this functionality
in context, please see vignette("quickstart").'><meta property="og:description" content='Return simulations of the trajectory of the output
variables of a dynamical model simulator. To see this functionality
in context, please see vignette("quickstart").'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/example_models.html">Example Models</a></li>
    <li><a class="dropdown-item" href="../articles/calibration.html">Calibrating Compartmental Models to Data</a></li>
    <li><a class="dropdown-item" href="../articles/real_data.html">Fitting to Real Data</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">Options</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate Dynamical Model Trajectories</h1>
      <small class="dont-index">Source: <a href="https://github.com/canmod/macpan2/blob/main/R/tmb_model.R" class="external-link"><code>R/tmb_model.R</code></a></small>
      <div class="d-none name"><code>mp_trajectory.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Return simulations of the trajectory of the output
variables of a dynamical model simulator. To see this functionality
in context, please see <code><a href="../articles/quickstart.html">vignette("quickstart")</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mp_trajectory</span><span class="op">(</span><span class="va">model</span>, include_initial <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mp_trajectory_par</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  parameter_updates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  include_initial <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_final <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  baseline <span class="op">=</span> <span class="fu"><a href="engine_functions.html">c</a></span><span class="op">(</span><span class="st">"recommended"</span>, <span class="st">"default"</span>, <span class="st">"optimized"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mp_trajectory_sd</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  conf.int <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  include_initial <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  back_transform <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mp_trajectory_ensemble</span><span class="op">(</span><span class="va">model</span>, <span class="va">n</span>, probs <span class="op">=</span> <span class="fu"><a href="engine_functions.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mp_trajectory_sim</span><span class="op">(</span><span class="va">model</span>, <span class="va">n</span>, probs <span class="op">=</span> <span class="fu"><a href="engine_functions.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mp_trajectory_replicate</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">n</span>,</span>
<span>  parameter_updates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  include_initial <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_final <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  baseline <span class="op">=</span> <span class="fu"><a href="engine_functions.html">c</a></span><span class="op">(</span><span class="st">"recommended"</span>, <span class="st">"default"</span>, <span class="st">"optimized"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A dynamical model simulator produced by
<code><a href="mp_simulator.html">mp_simulator</a></code>.</p></dd>


<dt id="arg-include-initial">include_initial<a class="anchor" aria-label="anchor" href="#arg-include-initial"></a></dt>
<dd><p>Should the initial values of the simulation be
included in the output? If <code>TRUE</code> this will include outputs for <code>time == 0</code>
associated with the initial values. See <code><a href="mp_initial.html">mp_initial</a></code> for another
approach to getting the initial values.</p></dd>


<dt id="arg-parameter-updates">parameter_updates<a class="anchor" aria-label="anchor" href="#arg-parameter-updates"></a></dt>
<dd><p>Named list of a subset of model variables with
the values to use when simulating the trajectory using the
<code>mp_trajectory_par</code> function. In the future we plan
to allow this variable to be a data frame with one row for each scalar value
(which would be useful if only certain elements of a vector
or matrix are parameters) and a string giving the name of a file containing
parameter information. But for now, only a list is allowed.</p></dd>


<dt id="arg-include-final">include_final<a class="anchor" aria-label="anchor" href="#arg-include-final"></a></dt>
<dd><p>Should the final values of the simulation, after the
post-simulation processing steps in the <code>after</code> stage of a model, be
included in the output? If <code>TRUE</code> this will include outputs for
<code>time == time_steps + 1</code>, associated with the values of the variables
after the full trajectory has been post-processed in the <code>after</code> stage.
See <code><a href="mp_final.html">mp_final</a></code> for another approach to getting the final values.</p></dd>


<dt id="arg-baseline">baseline<a class="anchor" aria-label="anchor" href="#arg-baseline"></a></dt>
<dd><p>Models can contain several alternative sets of
parameters, and this <code>baseline</code> argument is used to choose which of these
should be updated using the <code>parameter_updates</code> passed to
<code>mp_trajectory_par</code>. The current options are <code>"recommended"</code>, <code>"optimized"</code>,
and <code>"default"</code>. The <code>"recommended"</code> option will be used if neither of the
other two options are selected. If <code>model</code> is capable of being optimized
(e.g., it was created using <code><a href="mp_tmb_calibrator.html">mp_tmb_calibrator</a></code>) then
<code>"recommended"</code> is equivalent to <code>"optimized"</code>, which use the best set of
parameters found by <code><a href="mp_optimize.html">mp_optimize</a></code>. If <code><a href="mp_optimize.html">mp_optimize</a></code>
has not yet been called on <code>model</code> then a warning will be issued. If
<code>model</code> is not capable of being optimized then <code>"recommended"</code> is
equivalent to <code>"default"</code>, which uses the original set of parameters
available when <code>model</code> was created.</p></dd>


<dt id="arg-conf-int">conf.int<a class="anchor" aria-label="anchor" href="#arg-conf-int"></a></dt>
<dd><p>Should confidence intervals be produced?</p></dd>


<dt id="arg-conf-level">conf.level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>If <code>conf.int</code> is <code>TRUE</code>, what confidence level should be
used?  For example, the default of <code>0.95</code> corresponds to 95% confidence
intervals.</p></dd>


<dt id="arg-back-transform">back_transform<a class="anchor" aria-label="anchor" href="#arg-back-transform"></a></dt>
<dd><p>A boolean to indicate if trajectories, standard
deviations, and confidence intervals should be back transformed to
the original scale. Variable names are also stripped of their
transformation identifier. Currently, this back transformation only
applies to log transformed coefficients that have been named with "log_"
prefix or logit transformed coefficients that have been named with "logit_"
prefix. Back transformation also applies to time varying parameters and
distributional parameters that get automatic prefixes when used.
<code>back_transform</code> defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>Number of random trajectories to simulate.</p></dd>


<dt id="arg-probs">probs<a class="anchor" aria-label="anchor" href="#arg-probs"></a></dt>
<dd><p>Numeric vector of probabilities corresponding to quantiles for
summarizing the results over the random realizations.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with one row for each simulated value and the following
columns.</p><dl><dt>matrix</dt>
<dd><p>Name of the variable in the model. All variables are matrix-valued
in <code>macpan2</code> (scalars are technically 1-by-1 matrices), which explains
the name of this field. In hindsight I would have called it <code>variable</code>.</p></dd>

<dt>time</dt>
<dd><p>Time index of the simulated value, with <code>time = 0</code> indicating initial
values.</p></dd>

<dt>row</dt>
<dd><p>The 0-based index of the row of the matrix, or the name of the row
of the matrix if row names (or names for column vectors) are supplied
for the default value of the matrix.</p></dd>

<dt>col</dt>
<dd><p>The 0-based index of the column of the matrix, or the name of the column
of the matrix if column names are supplied for the default value of the
matrix. It is also possible that this column is blank if everything
is either a scalar or column vector (a common case).</p></dd>

<dt>value</dt>
<dd><p>(<code>mp_trajectory</code> and <code>mp_trajectory_sd</code>) Simulation values.</p></dd>

<dt>sd</dt>
<dd><p>(for <code>mp_trajectory_sd</code> only)
The standard deviations of the simulated values accounting for parameter
estimation uncertainty.</p></dd>

<dt>conf.low</dt>
<dd><p>(for <code>mp_trajectory_sd</code> only)
The lower bounds of the confidence interval for the simulated values.</p></dd>

<dt>conf.high</dt>
<dd><p>(for <code>mp_trajectory_sd</code> only)
The upper bounds of the confidence interval for the simulated values.</p></dd>

<dt>n%</dt>
<dd><p>(for <code>mp_trajectory_[ensemble|sim]</code>)
The n-th quantiles of the simulation values over repeated simulations.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>mp_trajectory_par()</code>: Produce a trajectory, after updating the <code>baseline</code>
set of parameters with values in <code>parameter_updates</code>.</p></li>
<li><p><code>mp_trajectory_sd()</code>: Simulate a trajectory that includes uncertainty
information provided by the <code>sdreport</code> function in <code>TMB</code> with default
settings.</p></li>
<li><p><code>mp_trajectory_ensemble()</code>: Simulate a trajectory that includes uncertainty
information provided by repeatedly sampling from a normal approximation to
the distribution of the fitted parameters, and generating one trajectory for
each of these samples. The quantiles of the empirical distribution of these
trajectories can be used to produce a confidence interval for the
fitted trajectory.</p></li>
<li><p><code>mp_trajectory_sim()</code>: Generate quantiles over <code>n</code> realizations of
the trajectory. Instead of a <code>value</code> column in the output data frame, there
is one column for each of the quantiles defined in <code>probs</code>.</p></li>
<li><p><code>mp_trajectory_replicate()</code>: Generate a list of <code>n</code> simulation results.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">spec</span> <span class="op">=</span> <span class="fu"><a href="mp_tmb_library.html">mp_tmb_library</a></span><span class="op">(</span><span class="st">"starter_models"</span></span></span>
<span class="r-in"><span>  , <span class="st">"si"</span></span></span>
<span class="r-in"><span>  , package <span class="op">=</span> <span class="st">"macpan2"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simulator</span> <span class="op">=</span> <span class="fu"><a href="mp_simulator.html">mp_simulator</a></span><span class="op">(</span><span class="va">spec</span></span></span>
<span class="r-in"><span>  , time_steps <span class="op">=</span> <span class="fl">10L</span></span></span>
<span class="r-in"><span>  , outputs <span class="op">=</span> <span class="fu"><a href="engine_functions.html">c</a></span><span class="op">(</span><span class="st">"infection"</span>, <span class="st">"I"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">trajectory</span> <span class="op">=</span> <span class="fu">mp_trajectory</span><span class="op">(</span><span class="va">simulator</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="engine_functions.html">print</a></span><span class="op">(</span><span class="va">trajectory</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       matrix time row col     value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          I    1   0   0 1.1980000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  infection    1   0   0 0.1980000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          I    2   0   0 1.4347296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  infection    2   0   0 0.2367296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          I    3   0   0 1.7175586</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  infection    3   0   0 0.2828290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7          I    4   0   0 2.0551703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  infection    4   0   0 0.3376117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          I    5   0   0 2.4577569</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 infection    5   0   0 0.4025866</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11         I    6   0   0 2.9372272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 infection    6   0   0 0.4794702</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         I    7   0   0 3.5074180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 infection    7   0   0 0.5701908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15         I    8   0   0 4.1842977</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 infection    8   0   0 0.6768796</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         I    9   0   0 4.9861405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 infection    9   0   0 0.8018428</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19         I   10   0   0 5.9336454</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 infection   10   0   0 0.9475049</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Walker, Weiguang Guan, Jen Freeman, Ben Bolker, Darren Flynn-Primrose.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

