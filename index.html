<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fast and Flexible Compartmental Modelling • macpan2</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fast and Flexible Compartmental Modelling">
<meta name="description" content="Fast and flexible compartmental modelling with Template Model Builder.">
<meta property="og:description" content="Fast and flexible compartmental modelling with Template Model Builder.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.16.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="articles/example_models.html">Example Models</a></li>
    <li><a class="dropdown-item" href="articles/calibration.html">Calibrating Compartmental Models to Data</a></li>
    <li><a class="dropdown-item" href="articles/real_data.html">Fitting to Real Data</a></li>
    <li><a class="dropdown-item" href="articles/state_updaters.html">ODE Solvers, Process Error, and Difference Equations</a></li>
    <li><a class="dropdown-item" href="articles/options.html">Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="macpan2">macpan2<a class="anchor" aria-label="anchor" href="#macpan2"></a>
</h1></div>
<!-- badges: start -->

<p><a href="https://github.com/mac-theobio/McMasterPandemic" class="external-link">McMasterPandemic</a> was developed to provide forecasts and insights to Canadian public health agencies throughout the COVID-19 pandemic. <a href="https://canmod.github.io/macpan-book/index.html#vision-and-direction" class="external-link">Much was learned</a> about developing general purpose compartmental modelling software during this experience, but the pressure to deliver regular forecasts made it difficult to focus on the software itself. The goal of this <code>macpan2</code> project is to re-imagine <code>McMasterPandemic</code>, building it from the ground up with architectural and technological decisions that address the many lessons that we learned from COVID-19 about software.</p>
<p>The <a href="https://github.com/phac-nml-phrsd" class="external-link">Public Health Risk Sciences Division</a> at the <a href="https://www.canada.ca/en/public-health.html" class="external-link">Public Health Agency of Canada</a> uses <code>macpan2</code> (for example, <a href="https://phac-nml-phrsd.github.io/EPACmodel/" class="external-link">here</a>).</p>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<ul>
<li><a href="https://canmod.github.io/macpan2/">Package reference</a></li>
<li><a href="https://canmod.github.io/macpan2/articles/quickstart">Quick-start guide</a></li>
<li>
<a href="https://canmod.github.io/macpan2/articles/cpp_side"><code>TMB</code> engine</a> [specification document]</li>
<li>
<a href="https://canmod.net/misc/pyRC" class="external-link">Project history and trajectory</a> [slides]</li>
<li><a href="https://drive.google.com/drive/folders/1NEQf2sy6QLxMiiWBN5Yn9U7wiPMs1jiS" class="external-link">Instructional videos</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The standard recommended way to install <code>macpan2</code> is with the following command.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>repos <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'https://canmod.r-universe.dev'</span>, <span class="st">'https://cloud.r-project.org'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'macpan2'</span>, <span class="at">repos =</span> repos)</span></code></pre></div>
<p>Many workflows with <code>macpan2</code> also make use of four widely used packages, which you can install with the following command.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"tidyr"</span>, <span class="st">"broom.mixed"</span>))</span></code></pre></div>
<p>To get the latest development version of <code>macpan2</code>, or if the above command fails for some reason, an alternative command to install is the following.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"canmod/macpan2"</span>)</span></code></pre></div>
<p>This command requires the <code>remotes</code> package and assumes that your <code>R</code> environment is set up to compile <code>C++</code> code contained in packages.</p>
</div>
<div class="section level2">
<h2 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a>
</h2>
<p>The <a href="https://r-universe.dev" class="external-link">r-universe</a>, which we use to distribute <code>macpan2</code>, suggests two approaches for projects in production that need to keep track of specific versions of <code>macpan2</code>: <a href="https://ropensci.org/blog/2023/05/31/runiverse-snapshots/" class="external-link">snapshots</a> or <a href="https://ropensci.org/blog/2022/01/06/runiverse-renv/" class="external-link"><code>renv</code></a>.</p>
<p>To take the first approach, snapshots of <code>macpan2</code> (and its dependency <code>oor</code>) can be obtained using the following download link.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>canmod.r<span class="sc">-</span>universe.dev<span class="sc">/</span>api<span class="sc">/</span>snapshot<span class="sc">/</span>zip?packages<span class="ot">=</span>macpan2,macpan2helpers,oor</span></code></pre></div>
<p>Please see <a href="https://canmod.r-universe.dev/apis" class="external-link">this documentation</a> for instructions on customizing this download link.</p>
<p>The benefit of the first approach is that it doesn’t require users to be able to compile C++ code, whereas the second does. The benefit of the second approach is that it can be used to manage dependencies on all packages in your workflows. It might be possible to combine the two approaches to get the best of both worlds, but this isn’t tested.</p>
</div>
<div class="section level2">
<h2 id="hello-world">Hello World<a class="anchor" aria-label="anchor" href="#hello-world"></a>
</h2>
<p>The following code specifies an <a href="https://github.com/canmod/macpan2/blob/main/inst/starter_models/si/README.md" class="external-link">SI model</a>, which is the simplest model of epidemiological transmission.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://canmod.github.io/macpan2/">macpan2</a></span><span class="op">)</span></span>
<span><span class="va">si</span> <span class="op">=</span> <span class="fu"><a href="reference/mp_tmb_model_spec.html">mp_tmb_model_spec</a></span><span class="op">(</span></span>
<span>    before <span class="op">=</span> <span class="va">S</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">I</span></span>
<span>  , during <span class="op">=</span> <span class="fu"><a href="reference/mp_per_capita_flow.html">mp_per_capita_flow</a></span><span class="op">(</span></span>
<span>        from     <span class="op">=</span> <span class="st">"S"</span>         <span class="co">## compartment from which individuals flow</span></span>
<span>      , to       <span class="op">=</span> <span class="st">"I"</span>         <span class="co">## compartment to which individuals flow</span></span>
<span>      , rate     <span class="op">=</span> <span class="st">"beta * I"</span>  <span class="co">## expression giving _per-capita_ flow rate</span></span>
<span>      , abs_rate <span class="op">=</span> <span class="st">"infection"</span> <span class="co">## name for _absolute_ flow rate = beta * I * S</span></span>
<span>    <span class="op">)</span></span>
<span>  , default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>I <span class="op">=</span> <span class="fl">0.01</span>, beta <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">si</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">## Default values:</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">##  quantity value</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="do">##         I  0.01</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="do">##      beta  0.20</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="do">## Before the simulation loop (t = 0):</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="do">## 1: S ~ 1 - I</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="do">## At every iteration of the simulation loop (t = 1 to T):</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="do">## 1: mp_per_capita_flow(from = "S", to = "I", rate = "beta * I", abs_rate = "infection")</span></span></code></pre></div>
<p>See <a href="https://canmod.github.io/macpan2/articles/example_models.html">this article</a> for more example models with documentation.</p>
<p>Simulating from this model requires choosing the number of time-steps to run and the model outputs to generate. Syntax for simulating <code>macpan2</code> models is <a href="https://canmod.github.io/macpan2/articles/quickstart.html#processing-results">designed to combine with standard data prep and plotting tools in R</a>, as we demonstrate with the following code.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">si</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/mp_simulator.html">mp_simulator</a></span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">50</span>, outputs <span class="op">=</span> <span class="fu"><a href="reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"infection"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/mp_trajectory.html">mp_trajectory</a></span><span class="op">(</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>quantity <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">matrix</span></span>
<span>    , <span class="st">"I"</span> <span class="op">~</span> <span class="st">"Prevalence"</span></span>
<span>    , <span class="st">"infection"</span> <span class="op">~</span> <span class="st">"Incidence"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> </span>
<span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> </span>
<span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">quantity</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/plot-tmb-si-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="product-management">Product Management<a class="anchor" aria-label="anchor" href="#product-management"></a>
</h2>
<p>The <a href="https://github.com/orgs/canmod/projects/2/views/6" class="external-link">project board</a> tracks the details of bugs, tasks, and feature development.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="table-of-contents">
<h2 data-toc-skip>Table of contents</h2>
<ul class="list-unstyled">
<li><nav id="toc"></nav></li>
</ul>
</div>

<div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/canmod/macpan2/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/canmod/macpan2/issues" class="external-link">Report a bug</a></li>
<li><a href="https://github.com/stevencarlislewalker" class="external-link">Maintainer</a></li>
<li><a href="https://github.com/orgs/canmod/projects/2" class="external-link">Roadmap</a></li>
<li><a href="https://canmod.net/misc/pyRC" class="external-link">Presentation slides</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing macpan2</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Steve Walker <br><small class="roles"> Maintainer, author </small>  </li>
<li>Weiguang Guan <br><small class="roles"> Author </small>  </li>
<li>Jen Freeman <br><small class="roles"> Author </small>  </li>
<li>Ben Bolker <br><small class="roles"> Author </small>  </li>
<li>Darren Flynn-Primrose <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://canmod.r-universe.dev/macpan2" class="external-link"><img src="https://canmod.r-universe.dev/badges/macpan2" alt="macpan2 status badge"></a></li>
<li><a href="https://github.com/canmod/macpan2/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/canmod/macpan2/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://github.com/canmod/macpan2/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://byob.yarr.is/canmod/macpan2/coverage" alt="test coverage"></a></li>
<li><a href="https://github.com/canmod/macpan2/commits" class="external-link"><img src="https://img.shields.io/github/commit-activity/m/canmod/macpan2" alt="commit activity"></a></li>
<li><a href="https://github.com/canmod/macpan2/graphs/contributors" class="external-link"><img src="https://img.shields.io/github/contributors/canmod/macpan2" alt="contributors"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Walker, Weiguang Guan, Jen Freeman, Ben Bolker, Darren Flynn-Primrose.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
