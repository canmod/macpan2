<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Fast and flexible compartmental modelling with Template Model Builder.">
<title>Fast and Flexible Compartmental Modelling â€¢ macpan2</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fast and Flexible Compartmental Modelling">
<meta property="og:description" content="Fast and flexible compartmental modelling with Template Model Builder.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">macpan2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/quickstart.html">Quickstart</a>
    <a class="dropdown-item" href="articles/example_models.html">Example Models</a>
    <a class="dropdown-item" href="articles/calibration.html">Calibrating Compartmental Models to Data</a>
    <a class="dropdown-item" href="articles/real_data.html">Fitting to Real Data</a>
    <a class="dropdown-item" href="articles/state_updaters.html">ODE Solvers, Process Error, and Difference Equations</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/canmod/macpan2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="macpan2">macpan2<a class="anchor" aria-label="anchor" href="#macpan2"></a>
</h1></div>
<!-- badges: start -->

<p><a href="https://github.com/mac-theobio/McMasterPandemic" class="external-link">McMasterPandemic</a> was developed to provide forecasts and insights to Canadian public health agencies throughout the COVID-19 pandemic. <a href="https://canmod.github.io/macpan-book/index.html#vision-and-direction" class="external-link">Much was learned</a> about developing general purpose compartmental modelling software during this experience, but the pressure to deliver regular forecasts made it difficult to focus on the software itself. The goal of this <code>macpan2</code> project is to re-imagine <code>McMasterPandemic</code>, building it from the ground up with architectural and technological decisions that address the many lessons that we learned from COVID-19 about software.</p>
<p>Impactful applied public health modelling requires many interdisciplinary steps along the path from epidemiological research teams to operational decision makers. Researchers must quickly tailor a model to an emerging public-health concern, validate and calibrate it to data, work with decision makers to define model outputs useful for stakeholders, configure models to generate those outputs, and package up those insights in an appropriate format for stakeholders. Unlike traditional modelling approaches, <code>macpan2</code> tackles this challenge from a software-engineering perspective, which allows us to systematically address bottlenecks along this path to impact in ways that will make future solutions easier to achieve. The goal is to enable researchers to focus on their core strengths and fill knowledge gaps efficiently and effectively.</p>
<p>Although <code>macpan2</code> is designed as a compartmental modelling tool that is agnostic about the underlying computational engine, it currently uses <a href="https://github.com/kaskr/adcomp" class="external-link">template model builder</a> as the sole engine. Template model builder (TMB) is an <code>R</code> modelling package based on a <code>C++</code> framework incorporating mature <a href="https://cppad.readthedocs.io/en/latest/user_guide.html" class="external-link">automatic differentiation</a> and <a href="http://eigen.tuxfamily.org/index.php?title=Main_Page" class="external-link">matrix algebra</a> libraries.</p>
<p>The <a href="https://github.com/phac-nml-phrsd" class="external-link">Public Health Risk Sciences Division</a> at the <a href="https://www.canada.ca/en/public-health.html" class="external-link">Public Health Agency of Canada</a> uses <code>macpan2</code> (for example, <a href="https://phac-nml-phrsd.github.io/EPACmodel/" class="external-link">here</a>).</p>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<ul>
<li><a href="https://canmod.github.io/macpan2/">Package reference</a></li>
<li><a href="https://canmod.github.io/macpan2/articles/quickstart">Quick-start guide</a></li>
<li>
<a href="https://canmod.github.io/macpan2/articles/cpp_side"><code>TMB</code> engine</a> [specification document]</li>
<li>
<a href="https://canmod.net/misc/macpan2_presentation" class="external-link">Project history and trajectory</a> [slides]</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The standard recommended way to install <code>macpan2</code> is with the following command.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>repos <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'https://canmod.r-universe.dev'</span>, <span class="st">'https://cloud.r-project.org'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'macpan2'</span>, <span class="at">repos =</span> repos)</span></code></pre></div>
<p>This command will install the current version of <code>macpan2</code>. There is no need to use <code>remotes::install_github</code> for the latest development version. For projects in production that need to keep track of specific versions of <code>macpan2</code>, snapshots and other reproducibility information can be obtained <a href="https://canmod.r-universe.dev/api" class="external-link">here</a>. Please see <a href="https://ropensci.org/blog/2022/01/06/runiverse-renv/" class="external-link">this article</a> for an explanation of how to manage reproducibility using <code>r-universe</code>.</p>
<p>Many workflows with <code>macpan2</code> also make use of the following packages.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"tidyr"</span>, <span class="st">"broom.mixed"</span>))</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hello-world">Hello World<a class="anchor" aria-label="anchor" href="#hello-world"></a>
</h2>
<p>The following code specifies an SI model, which is I think is the simplest possible model of epidemiological transmission.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://canmod.github.io/macpan2/">macpan2</a></span><span class="op">)</span></span>
<span><span class="va">si</span> <span class="op">=</span> <span class="fu"><a href="reference/mp_tmb_model_spec.html">mp_tmb_model_spec</a></span><span class="op">(</span></span>
<span>    before <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">I</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>      , <span class="va">S</span> <span class="op">~</span> <span class="va">N</span> <span class="op">-</span> <span class="va">I</span></span>
<span>    <span class="op">)</span></span>
<span>  , during <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">infection</span> <span class="op">~</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">S</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span></span>
<span>      , <span class="va">S</span> <span class="op">~</span> <span class="va">S</span> <span class="op">-</span> <span class="va">infection</span></span>
<span>      , <span class="va">I</span> <span class="op">~</span> <span class="va">I</span> <span class="op">+</span> <span class="va">infection</span></span>
<span>    <span class="op">)</span></span>
<span>  , default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">100</span>, beta <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/engine_functions.html">print</a></span><span class="op">(</span><span class="va">si</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## Default values:</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">##  matrix row col  value</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">##       N         100.00</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">##    beta           0.25</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="do">## Before the simulation loop (t = 0):</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="do">## 1: I ~ 1</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="do">## 2: S ~ N - I</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="do">## At every iteration of the simulation loop (t = 1 to T):</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="do">## ---------------------</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="do">## 1: infection ~ beta * S * I/N</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="do">## 2: S ~ S - infection</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="do">## 3: I ~ I + infection</span></span></code></pre></div>
<p>Simulating from this model requires choosing the number of time-steps to run and the model outputs to generate. Syntax for simulating <code>macpan2</code> models is <a href="https://canmod.github.io/macpan2/articles/quickstart.html#processing-results">designed to combine with standard data prep and plotting tools in R</a>, as we demonstrate with the following code.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">si</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/mp_simulator.html">mp_simulator</a></span><span class="op">(</span>time_steps <span class="op">=</span> <span class="fl">50</span>, outputs <span class="op">=</span> <span class="fu"><a href="reference/engine_functions.html">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"infection"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/mp_trajectory.html">mp_trajectory</a></span><span class="op">(</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>quantity <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">matrix</span></span>
<span>    , <span class="st">"I"</span> <span class="op">~</span> <span class="st">"Prevalance"</span></span>
<span>    , <span class="st">"infection"</span> <span class="op">~</span> <span class="st">"Incidence"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> </span>
<span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> </span>
<span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">quantity</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/plot-tmb-si-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="product-management">Product Management<a class="anchor" aria-label="anchor" href="#product-management"></a>
</h2>
<p>The <a href="https://github.com/orgs/canmod/projects/2" class="external-link">project board</a> tracks the details of bugs, tasks, and feature development.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="table-of-contents">
<h2 data-toc-skip>Table of contents</h2>
<ul class="list-unstyled">
<li><nav id="toc"></nav></li>
</ul>
</div>

<div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/canmod/macpan2/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/canmod/macpan2/issues" class="external-link">Report a bug</a></li>
<li><a href="https://github.com/orgs/canmod/projects/2" class="external-link">Roadmap</a></li>
<li><a href="https://canmod.net/misc/macpan2_presentation" class="external-link">Project history and trajectory</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing macpan2</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Steve Walker <br><small class="roles"> Maintainer, author </small>  </li>
<li>Weiguang Guan <br><small class="roles"> Author </small>  </li>
<li>Ben Bolker <br><small class="roles"> Author </small>  </li>
<li>Jen Freeman <br><small class="roles"> Author </small>  </li>
<li>Darren Flynn-Primrose <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://canmod.r-universe.dev/macpan2" class="external-link"><img src="https://canmod.r-universe.dev/badges/macpan2" alt="macpan2 status badge"></a></li>
<li><a href="https://github.com/canmod/macpan2/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/canmod/macpan2/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://github.com/canmod/macpan2/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://byob.yarr.is/canmod/macpan2/coverage" alt="test coverage"></a></li>
<li><a href="https://github.com/canmod/macpan2/commits" class="external-link"><img src="https://img.shields.io/github/commit-activity/m/canmod/macpan2" alt="commit activity"></a></li>
<li><a href="https://github.com/canmod/macpan2/graphs/contributors" class="external-link"><img src="https://img.shields.io/github/contributors/canmod/macpan2" alt="contributors"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Walker, Weiguang Guan, Ben Bolker, Jen Freeman, Darren Flynn-Primrose.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
