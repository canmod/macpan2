---
title: "awareness models"
index_entry: "behaviour modifications in response to death"
bibliography: ../../references.bib
link-citations: TRUE
author: Steve Walker
output: 
  github_document:
    toc: true
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.path = "./figures/"
)
```

SEIR-type models with awareness-driven behaviour, inspired by [@weitz2020awareness] and [@hurford2023pandemic].

# Packages Used

The code in this article uses the following packages.

```{r packages, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(macpan2)
```

# Model Specification

We describe several models here that have been specified in the `awareness` directory [here](https://github.com/canmod/macpan2/blob/main/inst/starter_models/awareness/tmb.R) and are accessible from the `macpan2` model library (see [Example Models](https://canmod.github.io/macpan2/articles/example_models.html) for details). We can read in the model specification using the `mp_tmb_library` command.
```{r model_spec}
specs = mp_tmb_library(
    "starter_models"
  , "awareness"
  , package = "macpan2"
  , alternative_specs = TRUE
)
print(names(specs))
```

These specifications can be used to draw the following flow diagrams using code found in the [source for this article](https://github.com/canmod/macpan2/blob/main/inst/starter_models/awareness/README.Rmd). This is the diagram for the simple awareness model. 

```{r diagram, echo = FALSE, fig.height = 2, fig.width = 5}
system.file("utils", "box-drawing.R", package = "macpan2") |> source()
layout = mp_layout_paths(specs$awareness_model)
plot_flow_diagram(layout)
```

The other three models in this example have a hospital box as well.

```{r diagram-delayed-death, echo = FALSE, fig.height = 2, fig.width = 5}
system.file("utils", "box-drawing.R", package = "macpan2") |> source()
layout = mp_layout_paths(specs$delayed_death_awareness_model)
plot_flow_diagram(layout)
```


# States

| variable | description  |
| -------- | ------------ |
| S        | Susceptible  |
| E        | Exposed      |
| I        | Infectious   |
| R        | Recovered    |
| D        | Dead         |
| H        | Hospitalized |
|          |              |


# Parameters

| variable               | description                                                                   |
| ---------------------- | ----------------------------------------------------------------------------- |
| $\beta$                | per capita transmission rate                                                  |
| $\mu$                  | per capita infection rate (average time spent in compartment E is $1/\alpha$) |
| $\gamma$               | per capita recovery/death rate                                                |
| `importation_prob`     | probability that one more infectious individual will arrive on any day.       |
| `memory_length`        | how long do people 'care about' deaths (days)                                 |
| $1/\gamma_h$           | mean time between isolation and death (days)                                  |
| $\delta_c$             | half-saturation constant for death awareness.                                 |
| $\delta_{\text{long}}$ | half-saturation constant for longer-term death awareness.                     |
| $f_D$                  | fraction of $\gamma$ that contributes to death rather than recovery           |
| $k$                    | exponent for half-saturation power law                                        |

# Base Awareness Model

$$
\begin{align*}
\frac{dS}{dt} &= -S\frac{\beta I}{N(1 + (I \gamma f_D / \delta_c)^k)} \\
\frac{dE}{dt} &= S\frac{\beta I}{N(1 + (I \gamma f_D / \delta_c)^k)} - \mu E \\
\frac{dI}{dt} &= \mu E- \gamma (1 - f_D) I \\
\frac{dR}{dt} &= \gamma (1 - f_D) I \\
\frac{dD}{dt} &= I \gamma f_D \\
\end{align*}
$$

# Delayed Death Awareness Model

$$
\begin{align*}
\frac{dS}{dt} &= -S\frac{\beta I}{N(1 + (I \gamma f_D / \delta_c)^k)} \\
\frac{dE}{dt} &= S\frac{\beta I}{N(1 + (I \gamma f_D / \delta_c)^k)} - \mu E \\
\frac{dI}{dt} &= \mu E- \gamma (1 - f_D) I \\
\frac{dR}{dt} &= \gamma (1 - f_D) I \\
\frac{dH}{dt} &= I \gamma f_D - H \gamma_h\\
\frac{dD}{dt} &= H \gamma_h \\
\end{align*}
$$

# Longer Memory Awareness Model

This model is identical to the [delayed death awareness model](#delayed-death-awareness-model), except that the factor $I \gamma f_D$ in the force of infection is replaced with a temporal convolution that takes a weighted average of past values with more recent values being weighted more heavily. See [here](https://github.com/canmod/macpan2/blob/main/inst/starter_models/awareness/tmb.R) for details.

# Importation Awareness Model

This model is identical to the [longer memory awareness model](#longer-memory-awareness-model) except that it includes random importations. These importations are simulated by drawing a Bernoulli random variable at each time step, adding it to the `I` box, and removing from the `R` box.
